<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 5 Usecases | ggkegg</title>

    <meta name="author" content="Noriaki Sato" />
  
   
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 5 Usecases | ggkegg" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Usecases | ggkegg" />
  
  
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.2/transition.js"></script>
    <script src="libs/bs3compat-0.4.2/tabs.js"></script>
    <script src="libs/bs3compat-0.4.2/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ggkegg</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="usecases" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Usecases</h1>
<div id="visualizing-numerical-attributes-from-deseq2" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Visualizing numerical attributes from DESeq2</h2>
<p>By providing the results of the DESeq2 package, which is often used for transcriptome analysis, it is possible to reflect numerical results in the nodes of a graph. The <code>assign_deseq2</code> function can be used for this purpose. By specifying the numerical value (e.g., <code>log2FoldChange</code>) that you want to reflect in the graph as the <code>column</code> argument, you can assign the value to the nodes. If multiple genes are hit, the <code>numeric_combine</code> argument specifies how to combine multiple values (the default is <code>mean</code>).</p>
<p>Here, we use a RNA-Seq dataset that analyzed the transcriptome changes in human urothelial cells infected with BK polyomavirus (<a href="https://doi.org/10.1038/s41388-022-02235-8">Baker et al. 2022</a>). The raw sequences obtained from Sequence Read Archive were processed by <a href="https://nf-co.re/rnaseq">nf-core</a>, and subsequently analyzed using <code>tximport</code>, <code>salmon</code> and <code>DESeq2</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="usecases.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggkegg)</span>
<span id="cb35-2"><a href="usecases.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb35-3"><a href="usecases.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Hs.eg.db)</span>
<span id="cb35-4"><a href="usecases.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-5"><a href="usecases.html#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="usecases.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;uro.deseq.res.rda&quot;</span>) <span class="do">## Storing DESeq() result</span></span>
<span id="cb35-7"><a href="usecases.html#cb35-7" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb35-8"><a href="usecases.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class: DESeqDataSet </span></span>
<span id="cb35-9"><a href="usecases.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dim: 29744 26 </span></span>
<span id="cb35-10"><a href="usecases.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; metadata(1): version</span></span>
<span id="cb35-11"><a href="usecases.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; assays(8): counts avgTxLength ... replaceCounts</span></span>
<span id="cb35-12"><a href="usecases.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   replaceCooks</span></span>
<span id="cb35-13"><a href="usecases.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rownames(29744): A1BG A1BG-AS1 ... ZZEF1 ZZZ3</span></span>
<span id="cb35-14"><a href="usecases.html#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; rowData names(27): baseMean baseVar ... maxCooks</span></span>
<span id="cb35-15"><a href="usecases.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   replace</span></span>
<span id="cb35-16"><a href="usecases.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colnames(26): SRR14509882 SRR14509883 ... SRR14509906</span></span>
<span id="cb35-17"><a href="usecases.html#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   SRR14509907</span></span>
<span id="cb35-18"><a href="usecases.html#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colData names(27): Assay.Type AvgSpotLen ...</span></span>
<span id="cb35-19"><a href="usecases.html#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   viral_infection replaceable</span></span>
<span id="cb35-20"><a href="usecases.html#cb35-20" aria-hidden="true" tabindex="-1"></a>vinf <span class="ot">&lt;-</span> <span class="fu">results</span>(res, <span class="at">contrast=</span><span class="fu">c</span>(<span class="st">&quot;viral_infection&quot;</span>,<span class="st">&quot;BKPyV (Dunlop) MOI=1&quot;</span>,<span class="st">&quot;No infection&quot;</span>))</span>
<span id="cb35-21"><a href="usecases.html#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="usecases.html#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="do">## LFC</span></span>
<span id="cb35-23"><a href="usecases.html#cb35-23" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa04110&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">deseq2=</span><span class="fu">assign_deseq2</span>(vinf),</span>
<span id="cb35-24"><a href="usecases.html#cb35-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">padj=</span><span class="fu">assign_deseq2</span>(vinf, <span class="at">column=</span><span class="st">&quot;padj&quot;</span>),</span>
<span id="cb35-25"><a href="usecases.html#cb35-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">converted_name=</span><span class="fu">convert_id</span>(<span class="st">&quot;hsa&quot;</span>))</span>
<span id="cb35-26"><a href="usecases.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="usecases.html#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(g, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y) <span class="sc">+</span> </span>
<span id="cb35-28"><a href="usecases.html#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">width=</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;mm&#39;</span>)), </span>
<span id="cb35-29"><a href="usecases.html#cb35-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">square</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb35-30"><a href="usecases.html#cb35-30" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">square</span>(<span class="fl">1.5</span>, <span class="st">&#39;cm&#39;</span>), <span class="fu">aes</span>(<span class="at">color=</span>subtype))<span class="sc">+</span></span>
<span id="cb35-31"><a href="usecases.html#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>deseq2, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>), <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb35-32"><a href="usecases.html#cb35-32" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>converted_name, <span class="at">filter=</span>type<span class="sc">!=</span><span class="st">&quot;group&quot;</span>), <span class="at">size=</span><span class="fl">2.5</span>), <span class="at">colour=</span><span class="st">&quot;white&quot;</span>, <span class="at">expand=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb35-33"><a href="usecases.html#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">&quot;blue&quot;</span>,<span class="at">high=</span><span class="st">&quot;red&quot;</span>, <span class="at">name=</span><span class="st">&quot;LFC&quot;</span>)<span class="sc">+</span></span>
<span id="cb35-34"><a href="usecases.html#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/deseq2-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="usecases.html#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="usecases.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Adjusted p-values</span></span>
<span id="cb36-3"><a href="usecases.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(g, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y) <span class="sc">+</span> </span>
<span id="cb36-4"><a href="usecases.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">width=</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;mm&#39;</span>)), </span>
<span id="cb36-5"><a href="usecases.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">square</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb36-6"><a href="usecases.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">square</span>(<span class="fl">1.5</span>, <span class="st">&#39;cm&#39;</span>), <span class="fu">aes</span>(<span class="at">color=</span>subtype))<span class="sc">+</span></span>
<span id="cb36-7"><a href="usecases.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>padj, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>), <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb36-8"><a href="usecases.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>converted_name, <span class="at">filter=</span>type<span class="sc">!=</span><span class="st">&quot;group&quot;</span>), <span class="at">size=</span><span class="fl">2.5</span>), <span class="at">colour=</span><span class="st">&quot;white&quot;</span>, <span class="at">expand=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb36-9"><a href="usecases.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name=</span><span class="st">&quot;padj&quot;</span>)<span class="sc">+</span></span>
<span id="cb36-10"><a href="usecases.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/deseq2-2.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="usecases.html#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="usecases.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Adjusted p-values</span></span>
<span id="cb37-3"><a href="usecases.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(g, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y) <span class="sc">+</span> </span>
<span id="cb37-4"><a href="usecases.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">width=</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;mm&#39;</span>)), </span>
<span id="cb37-5"><a href="usecases.html#cb37-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">square</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb37-6"><a href="usecases.html#cb37-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">square</span>(<span class="fl">1.5</span>, <span class="st">&#39;cm&#39;</span>), <span class="fu">aes</span>(<span class="at">color=</span>subtype))<span class="sc">+</span></span>
<span id="cb37-7"><a href="usecases.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>padj, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>), <span class="at">color=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-8"><a href="usecases.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>converted_name, <span class="at">filter=</span>type<span class="sc">!=</span><span class="st">&quot;group&quot;</span>), <span class="at">size=</span><span class="fl">2.5</span>), <span class="at">colour=</span><span class="st">&quot;white&quot;</span>, <span class="at">expand=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb37-9"><a href="usecases.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name=</span><span class="st">&quot;padj&quot;</span>)<span class="sc">+</span></span>
<span id="cb37-10"><a href="usecases.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/deseq2-3.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="usecases.html#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="usecases.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Highlighting differentially expressed genes at adjusted p-values &lt; 0.05 with coloring of adjusted p-values on raw KEGG map</span></span>
<span id="cb38-3"><a href="usecases.html#cb38-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y)<span class="sc">+</span></span>
<span id="cb38-4"><a href="usecases.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>padj, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>))<span class="sc">+</span></span>
<span id="cb38-5"><a href="usecases.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>padj, <span class="at">filter=</span><span class="sc">!</span><span class="fu">is.na</span>(padj) <span class="sc">&amp;</span> padj<span class="sc">&lt;</span><span class="fl">0.05</span>)),</span>
<span id="cb38-6"><a href="usecases.html#cb38-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;yellow&quot;</span>, <span class="at">expand=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb38-7"><a href="usecases.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlay_raw_map</span>(<span class="st">&quot;hsa04110&quot;</span>, <span class="at">transparent_colors =</span> <span class="fu">c</span>(<span class="st">&quot;#cccccc&quot;</span>,<span class="st">&quot;#FFFFFF&quot;</span>,<span class="st">&quot;#BFBFFF&quot;</span>,<span class="st">&quot;#BFFFBF&quot;</span>))<span class="sc">+</span></span>
<span id="cb38-8"><a href="usecases.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">&quot;pink&quot;</span>,<span class="at">high=</span><span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb38-9"><a href="usecases.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="usecases.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file=</span><span class="st">&quot;tmp.png&quot;</span>,gg,<span class="at">width=</span><span class="dv">20</span>,<span class="at">height=</span><span class="dv">15</span>,<span class="at">dpi=</span><span class="dv">300</span>,<span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span>
<span id="cb38-11"><a href="usecases.html#cb38-11" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>()<span class="sc">+</span>cowplot<span class="sc">::</span><span class="fu">draw_image</span>(<span class="st">&quot;tmp.png&quot;</span>)</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/deseq2-4.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="integrating-matrix-to-tbl_graph" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Integrating matrix to <code>tbl_graph</code></h2>
<p>If you want to reflect an expression matrix in a graph, the <code>append_edge_value</code> and <code>append_node_value</code> functions can be useful. By specifying a matrix and gene IDs, you can assign numeric values for each sample to the <code>tbl_graph</code>. <code>append_edge_value</code> assigns the sum of the two nodes connected by an edge, ignoring group nodes (<a href="https://doi.org/10.1186/s12859-020-03692-2">Adnan et al. 2020</a>).</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="usecases.html#cb39-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(<span class="fu">vst</span>(res))</span>
<span id="cb39-2"><a href="usecases.html#cb39-2" aria-hidden="true" tabindex="-1"></a>new_g <span class="ot">&lt;-</span> g <span class="sc">|&gt;</span> <span class="fu">edge_matrix</span>(mat) <span class="sc">|&gt;</span> <span class="fu">node_matrix</span>(mat)</span>
<span id="cb39-3"><a href="usecases.html#cb39-3" aria-hidden="true" tabindex="-1"></a>new_g</span>
<span id="cb39-4"><a href="usecases.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tbl_graph: 134 nodes and 157 edges</span></span>
<span id="cb39-5"><a href="usecases.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #</span></span>
<span id="cb39-6"><a href="usecases.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A directed acyclic multigraph with 40 components</span></span>
<span id="cb39-7"><a href="usecases.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #</span></span>
<span id="cb39-8"><a href="usecases.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 134 × 47</span></span>
<span id="cb39-9"><a href="usecases.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name        type  reaction graphics_name     x     y width</span></span>
<span id="cb39-10"><a href="usecases.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb39-11"><a href="usecases.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 hsa:1029    gene  &lt;NA&gt;     CDKN2A, ARF,…   532  -218    46</span></span>
<span id="cb39-12"><a href="usecases.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 hsa:51343   gene  &lt;NA&gt;     FZR1, CDC20C…   981  -630    46</span></span>
<span id="cb39-13"><a href="usecases.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 hsa:4171 h… gene  &lt;NA&gt;     MCM2, BM28, …   553  -681    46</span></span>
<span id="cb39-14"><a href="usecases.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 hsa:23594 … gene  &lt;NA&gt;     ORC6, ORC6L.…   494  -681    46</span></span>
<span id="cb39-15"><a href="usecases.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -392    46</span></span>
<span id="cb39-16"><a href="usecases.html#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -613    46</span></span>
<span id="cb39-17"><a href="usecases.html#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 128 more rows</span></span>
<span id="cb39-18"><a href="usecases.html#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 40 more variables: height &lt;dbl&gt;, fgcolor &lt;chr&gt;,</span></span>
<span id="cb39-19"><a href="usecases.html#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   bgcolor &lt;chr&gt;, graphics_type &lt;chr&gt;, coords &lt;chr&gt;,</span></span>
<span id="cb39-20"><a href="usecases.html#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   xmin &lt;dbl&gt;, xmax &lt;dbl&gt;, ymin &lt;dbl&gt;, ymax &lt;dbl&gt;,</span></span>
<span id="cb39-21"><a href="usecases.html#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   orig.id &lt;chr&gt;, pathway_id &lt;chr&gt;, deseq2 &lt;dbl&gt;,</span></span>
<span id="cb39-22"><a href="usecases.html#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   padj &lt;dbl&gt;, converted_name &lt;chr&gt;, SRR14509882 &lt;dbl&gt;,</span></span>
<span id="cb39-23"><a href="usecases.html#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509883 &lt;dbl&gt;, SRR14509884 &lt;dbl&gt;, …</span></span>
<span id="cb39-24"><a href="usecases.html#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #</span></span>
<span id="cb39-25"><a href="usecases.html#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 157 × 32</span></span>
<span id="cb39-26"><a href="usecases.html#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    from    to type  subtype        from_nd to_nd SRR14509882</span></span>
<span id="cb39-27"><a href="usecases.html#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span id="cb39-28"><a href="usecases.html#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   118    39 GErel expression     undefi… hsa:…        NA  </span></span>
<span id="cb39-29"><a href="usecases.html#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    50    61 PPrel inhibition     hsa:29… hsa:…        24.4</span></span>
<span id="cb39-30"><a href="usecases.html#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    50    61 PPrel phosphorylati… hsa:29… hsa:…        24.4</span></span>
<span id="cb39-31"><a href="usecases.html#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 154 more rows</span></span>
<span id="cb39-32"><a href="usecases.html#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ℹ 25 more variables: SRR14509883 &lt;dbl&gt;,</span></span>
<span id="cb39-33"><a href="usecases.html#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509884 &lt;dbl&gt;, SRR14509885 &lt;dbl&gt;,</span></span>
<span id="cb39-34"><a href="usecases.html#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509886 &lt;dbl&gt;, SRR14509887 &lt;dbl&gt;,</span></span>
<span id="cb39-35"><a href="usecases.html#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509888 &lt;dbl&gt;, SRR14509889 &lt;dbl&gt;,</span></span>
<span id="cb39-36"><a href="usecases.html#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509890 &lt;dbl&gt;, SRR14509891 &lt;dbl&gt;,</span></span>
<span id="cb39-37"><a href="usecases.html#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   SRR14509892 &lt;dbl&gt;, SRR14509893 &lt;dbl&gt;, …</span></span></code></pre></div>
</div>
<div id="visualizing-multiple-enrichment-results" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Visualizing multiple enrichment results</h2>
<p>You can visualize the results of multiple enrichment analyses. Similar to using the <code>ggkegg</code> function with the <code>enrichResult</code> class, there is an <code>append_cp</code> function that can be used within the <code>mutate</code> function. By providing an <code>enrichResult</code> object to this function, if the pathway being visualized is present in the result, the gene information within the pathway can be reflected in the graph. In this example, in addition to the changes in urothelial cells mentioned above, changes in renal proximal tubular epithelial cells are being compared (<a href="https://doi.org/10.1128/mbio.00903-16">Assetta et al. 2016</a>).</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="usecases.html#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="usecases.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="do">## These are RDAs storing DEGs</span></span>
<span id="cb40-3"><a href="usecases.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;degListRPTEC.rda&quot;</span>)</span>
<span id="cb40-4"><a href="usecases.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;degURO.rda&quot;</span>)</span>
<span id="cb40-5"><a href="usecases.html#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="usecases.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Hs.eg.db);</span>
<span id="cb40-7"><a href="usecases.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clusterProfiler);</span>
<span id="cb40-8"><a href="usecases.html#cb40-8" aria-hidden="true" tabindex="-1"></a>input_uro <span class="ot">&lt;-</span> <span class="fu">bitr</span>(uroUp, <span class="do">## DEGs in urothelial cells</span></span>
<span id="cb40-9"><a href="usecases.html#cb40-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">fromType =</span> <span class="st">&quot;SYMBOL&quot;</span>,</span>
<span id="cb40-10"><a href="usecases.html#cb40-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">toType =</span> <span class="st">&quot;ENTREZID&quot;</span>,</span>
<span id="cb40-11"><a href="usecases.html#cb40-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb40-12"><a href="usecases.html#cb40-12" aria-hidden="true" tabindex="-1"></a>input_rptec <span class="ot">&lt;-</span> <span class="fu">bitr</span>(gls<span class="sc">$</span>day3_up_rptec, <span class="do">## DEGs at 3 days post infection in RPTECs</span></span>
<span id="cb40-13"><a href="usecases.html#cb40-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">fromType =</span> <span class="st">&quot;SYMBOL&quot;</span>,</span>
<span id="cb40-14"><a href="usecases.html#cb40-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">toType =</span> <span class="st">&quot;ENTREZID&quot;</span>,</span>
<span id="cb40-15"><a href="usecases.html#cb40-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb40-16"><a href="usecases.html#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="usecases.html#cb40-17" aria-hidden="true" tabindex="-1"></a>ekuro <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(<span class="at">gene =</span> input_uro)</span>
<span id="cb40-18"><a href="usecases.html#cb40-18" aria-hidden="true" tabindex="-1"></a>ekrptec <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(<span class="at">gene =</span> input_rptec)</span>
<span id="cb40-19"><a href="usecases.html#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="usecases.html#cb40-20" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa04110&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">uro=</span><span class="fu">append_cp</span>(ekuro, <span class="at">how=</span><span class="st">&quot;all&quot;</span>),</span>
<span id="cb40-21"><a href="usecases.html#cb40-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">rptec=</span><span class="fu">append_cp</span>(ekrptec, <span class="at">how=</span><span class="st">&quot;all&quot;</span>),</span>
<span id="cb40-22"><a href="usecases.html#cb40-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">converted_name=</span><span class="fu">convert_id</span>(<span class="st">&quot;hsa&quot;</span>))</span>
<span id="cb40-23"><a href="usecases.html#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(g1, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y) <span class="sc">+</span> </span>
<span id="cb40-24"><a href="usecases.html#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">width=</span><span class="fl">0.5</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;mm&#39;</span>)), </span>
<span id="cb40-25"><a href="usecases.html#cb40-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> <span class="fu">square</span>(<span class="dv">1</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb40-26"><a href="usecases.html#cb40-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> <span class="fu">square</span>(<span class="fl">1.5</span>, <span class="st">&#39;cm&#39;</span>), <span class="fu">aes</span>(<span class="at">color=</span>subtype))<span class="sc">+</span></span>
<span id="cb40-27"><a href="usecases.html#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>uro, <span class="at">xmax=</span>x,  <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>))<span class="sc">+</span></span>
<span id="cb40-28"><a href="usecases.html#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>rptec, <span class="at">xmin=</span>x, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>))<span class="sc">+</span></span>
<span id="cb40-29"><a href="usecases.html#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>,<span class="st">&quot;tomato&quot;</span>), <span class="at">name=</span><span class="st">&quot;urothelial|rptec&quot;</span>)<span class="sc">+</span></span>
<span id="cb40-30"><a href="usecases.html#cb40-30" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>converted_name, <span class="at">filter=</span>type<span class="sc">!=</span><span class="st">&quot;group&quot;</span>), <span class="at">size=</span><span class="dv">2</span>), <span class="at">colour=</span><span class="st">&quot;white&quot;</span>, <span class="at">expand=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb40-31"><a href="usecases.html#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/multcp-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>The example below applies a similar reflection to the Raw KEGG map and highlights genes that show statistically significant changes under both conditions using <code>ggfx</code> in yellow outer glow, with composing <code>dotplot</code> produced by clusterProfiler for the enrichment results by <code>patchwork</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="usecases.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb41-2"><a href="usecases.html#cb41-2" aria-hidden="true" tabindex="-1"></a>right <span class="ot">&lt;-</span> (<span class="fu">dotplot</span>(ekuro) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Urothelial&quot;</span>)) <span class="sc">/</span></span>
<span id="cb41-3"><a href="usecases.html#cb41-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">dotplot</span>(ekrptec) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;RPTECs&quot;</span>))</span>
<span id="cb41-4"><a href="usecases.html#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="usecases.html#cb41-5" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa03410&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="usecases.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uro=</span><span class="fu">append_cp</span>(ekuro, <span class="at">how=</span><span class="st">&quot;all&quot;</span>),</span>
<span id="cb41-7"><a href="usecases.html#cb41-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">rptec=</span><span class="fu">append_cp</span>(ekrptec, <span class="at">how=</span><span class="st">&quot;all&quot;</span>),</span>
<span id="cb41-8"><a href="usecases.html#cb41-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">converted_name=</span><span class="fu">convert_id</span>(<span class="st">&quot;hsa&quot;</span>))</span>
<span id="cb41-9"><a href="usecases.html#cb41-9" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g1, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y)<span class="sc">+</span></span>
<span id="cb41-10"><a href="usecases.html#cb41-10" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb41-11"><a href="usecases.html#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>uro<span class="sc">&amp;</span>rptec),</span>
<span id="cb41-12"><a href="usecases.html#cb41-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span><span class="st">&quot;gold&quot;</span>, <span class="at">fill=</span><span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb41-13"><a href="usecases.html#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="st">&quot;gold&quot;</span>, <span class="at">expand=</span><span class="dv">15</span>, <span class="at">sigma=</span><span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb41-14"><a href="usecases.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>uro, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>))<span class="sc">+</span></span>
<span id="cb41-15"><a href="usecases.html#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">fill=</span>rptec, <span class="at">xmin=</span>x, <span class="at">filter=</span>type<span class="sc">==</span><span class="st">&quot;gene&quot;</span>)) <span class="sc">+</span></span>
<span id="cb41-16"><a href="usecases.html#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlay_raw_map</span>(<span class="st">&quot;hsa03410&quot;</span>, <span class="at">transparent_colors =</span> <span class="fu">c</span>(<span class="st">&quot;#cccccc&quot;</span>,<span class="st">&quot;#FFFFFF&quot;</span>,<span class="st">&quot;#BFBFFF&quot;</span>,<span class="st">&quot;#BFFFBF&quot;</span>))<span class="sc">+</span></span>
<span id="cb41-17"><a href="usecases.html#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>,<span class="st">&quot;tomato&quot;</span>),</span>
<span id="cb41-18"><a href="usecases.html#cb41-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name=</span><span class="st">&quot;urothelial|rptec&quot;</span>)<span class="sc">+</span></span>
<span id="cb41-19"><a href="usecases.html#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb41-20"><a href="usecases.html#cb41-20" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> gg <span class="sc">+</span> right <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design=</span><span class="st">&quot;</span></span>
<span id="cb41-21"><a href="usecases.html#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="st">AAAA###</span></span>
<span id="cb41-22"><a href="usecases.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="st">AAAABBB</span></span>
<span id="cb41-23"><a href="usecases.html#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="st">AAAABBB</span></span>
<span id="cb41-24"><a href="usecases.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="st">AAAA###</span></span>
<span id="cb41-25"><a href="usecases.html#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb41-26"><a href="usecases.html#cb41-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-27"><a href="usecases.html#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file=</span><span class="st">&quot;tmp.png&quot;</span>,gg2,<span class="at">width=</span><span class="dv">20</span>,<span class="at">height=</span><span class="dv">15</span>,<span class="at">dpi=</span><span class="dv">300</span>,<span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span>
<span id="cb41-28"><a href="usecases.html#cb41-28" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>()<span class="sc">+</span>cowplot<span class="sc">::</span><span class="fu">draw_image</span>(<span class="st">&quot;tmp.png&quot;</span>)</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/multcp2-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="projecting-the-gene-regulatory-networks-on-kegg-map" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Projecting the gene regulatory networks on KEGG map</h2>
<p>With this package, it is possible to project inferred networks such as gene regulatory networks or KO networks inferred by other software onto KEGG maps. The following is an example of projecting a subset of KO networks within a pathway inferred by CBNplot onto the reference map of the corresponding pathway using <code>MicrobiomeProfiler</code>. Of course, it is also possible to project networks created using other methods.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="usecases.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb42-2"><a href="usecases.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb42-3"><a href="usecases.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb42-4"><a href="usecases.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CBNplot)</span>
<span id="cb42-5"><a href="usecases.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggkegg)</span>
<span id="cb42-6"><a href="usecases.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MicrobiomeProfiler)</span>
<span id="cb42-7"><a href="usecases.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Rat_data)</span>
<span id="cb42-8"><a href="usecases.html#cb42-8" aria-hidden="true" tabindex="-1"></a>ko.res <span class="ot">&lt;-</span> <span class="fu">enrichKO</span>(Rat_data)</span>
<span id="cb42-9"><a href="usecases.html#cb42-9" aria-hidden="true" tabindex="-1"></a>exp.dat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">910</span>)), <span class="dv">91</span>, <span class="dv">10</span>) <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">set_rownames</span>(<span class="at">value=</span>Rat_data) <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="at">value=</span><span class="fu">paste0</span>(<span class="st">&#39;S&#39;</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(.))))</span>
<span id="cb42-10"><a href="usecases.html#cb42-10" aria-hidden="true" tabindex="-1"></a>returnnet <span class="ot">&lt;-</span> <span class="fu">bngeneplot</span>(ko.res, <span class="at">exp=</span>exp.dat, <span class="at">pathNum=</span><span class="dv">1</span>, <span class="at">orgDb=</span><span class="cn">NULL</span>,<span class="at">returnNet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-11"><a href="usecases.html#cb42-11" aria-hidden="true" tabindex="-1"></a>pg <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;ko00650&quot;</span>)</span>
<span id="cb42-12"><a href="usecases.html#cb42-12" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> <span class="fu">combine_with_bnlearn</span>(pg, returnnet<span class="sc">$</span>str, returnnet<span class="sc">$</span>av)</span></code></pre></div>
<p>Plot the resulting map. In this example, the strength estimated by <code>CBNplot</code> is first displayed with colored edges, and then the edges of the reference graph are drawn in black on top of it. Also, edges included in both graphs are highlighted by yellow.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="usecases.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Summarize duplicate edges including `strength` attribute</span></span>
<span id="cb43-2"><a href="usecases.html#cb43-2" aria-hidden="true" tabindex="-1"></a>number <span class="ot">&lt;-</span> joined <span class="sc">|&gt;</span> <span class="fu">activate</span>(edges) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">group_by</span>(from,to) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="usecases.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>(), <span class="at">incstr=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(strength)))</span>
<span id="cb43-4"><a href="usecases.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="usecases.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Annotate them</span></span>
<span id="cb43-6"><a href="usecases.html#cb43-6" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> joined <span class="sc">|&gt;</span> <span class="fu">activate</span>(edges) <span class="sc">|&gt;</span> <span class="fu">full_join</span>(number) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">both=</span>n<span class="sc">&gt;</span><span class="dv">1</span><span class="sc">&amp;</span>incstr<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb43-7"><a href="usecases.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="usecases.html#cb43-8" aria-hidden="true" tabindex="-1"></a>joined <span class="sc">|&gt;</span> </span>
<span id="cb43-9"><a href="usecases.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(nodes) <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="usecases.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type)) <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="usecases.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">convertKO=</span><span class="fu">convert_id</span>(<span class="st">&quot;ko&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-12"><a href="usecases.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(edges) <span class="sc">|&gt;</span></span>
<span id="cb43-13"><a href="usecases.html#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">x=</span>x, <span class="at">y=</span>y) <span class="sc">+</span></span>
<span id="cb43-14"><a href="usecases.html#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">width=</span><span class="fl">0.5</span>,<span class="fu">aes</span>(<span class="at">filter=</span><span class="sc">!</span><span class="fu">is.na</span>(strength),</span>
<span id="cb43-15"><a href="usecases.html#cb43-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color=</span>strength), <span class="at">linetype=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb43-16"><a href="usecases.html#cb43-16" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb43-17"><a href="usecases.html#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_edge_link0</span>(<span class="at">width=</span><span class="fl">0.5</span>,<span class="fu">aes</span>(<span class="at">filter=</span><span class="sc">!</span><span class="fu">is.na</span>(strength) <span class="sc">&amp;</span> both,</span>
<span id="cb43-18"><a href="usecases.html#cb43-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color=</span>strength), <span class="at">linetype=</span><span class="dv">1</span>),</span>
<span id="cb43-19"><a href="usecases.html#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="st">&quot;yellow&quot;</span>, <span class="at">sigma=</span><span class="dv">1</span>, <span class="at">expand=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb43-20"><a href="usecases.html#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">width=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">filter=</span><span class="fu">is.na</span>(strength)))<span class="sc">+</span></span>
<span id="cb43-21"><a href="usecases.html#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_color_gradient</span>(<span class="at">low=</span><span class="st">&quot;blue&quot;</span>,<span class="at">high=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb43-22"><a href="usecases.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_rect</span>(<span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">fill=</span>type))<span class="sc">+</span></span>
<span id="cb43-23"><a href="usecases.html#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>convertKO), <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb43-24"><a href="usecases.html#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;:&quot;</span>, graphics_name), <span class="fu">strsplit</span>(graphics_name, <span class="st">&quot;:&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-25"><a href="usecases.html#cb43-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">sapply</span>(<span class="st">&quot;[&quot;</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="dv">22</span>), stringr<span class="sc">::</span><span class="fu">str_wrap</span>(graphics_name, <span class="dv">22</span>)),</span>
<span id="cb43-26"><a href="usecases.html#cb43-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">filter=</span><span class="sc">!</span><span class="fu">is.na</span>(type) <span class="sc">&amp;</span> type<span class="sc">==</span><span class="st">&quot;map&quot;</span>), <span class="at">family=</span><span class="st">&quot;serif&quot;</span>,</span>
<span id="cb43-27"><a href="usecases.html#cb43-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="dv">2</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb43-28"><a href="usecases.html#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/konetplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="cluster-marker-genes-in-single-cell-transcriptomics" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Cluster marker genes in single-cell transcriptomics</h2>
<p>This package can also be applied to single-cell analysis. As an example, consider mapping marker genes between clusters onto KEGG pathways and plotting them together with reduced dimension plots. Here, we use the <code>Seurat</code> package. We conduct a fundamental analysis.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="usecases.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb44-2"><a href="usecases.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dir = &quot;../filtered_gene_bc_matrices/hg19&quot;</span></span>
<span id="cb44-3"><a href="usecases.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc.data &lt;- Read10X(data.dir = dir)</span></span>
<span id="cb44-4"><a href="usecases.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;,</span></span>
<span id="cb44-5"><a href="usecases.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                            min.cells=3, min.features=200)</span></span>
<span id="cb44-6"><a href="usecases.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- NormalizeData(pbmc)</span></span>
<span id="cb44-7"><a href="usecases.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- FindVariableFeatures(pbmc, selection.method = &quot;vst&quot;)</span></span>
<span id="cb44-8"><a href="usecases.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- ScaleData(pbmc, features = row.names(pbmc))</span></span>
<span id="cb44-9"><a href="usecases.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))</span></span>
<span id="cb44-10"><a href="usecases.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- FindNeighbors(pbmc, dims = 1:10, verbose = FALSE)</span></span>
<span id="cb44-11"><a href="usecases.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- FindClusters(pbmc, resolution = 0.5, verbose = FALSE)</span></span>
<span id="cb44-12"><a href="usecases.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># pbmc &lt;- RunUMAP(pbmc, dims = 1:10, umap.method = &quot;uwot&quot;, metric = &quot;cosine&quot;)</span></span>
<span id="cb44-13"><a href="usecases.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># markers &lt;- FindAllMarkers(pbmc)</span></span>
<span id="cb44-14"><a href="usecases.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># save(pbmc, markers, file=&quot;../sc_data.rda&quot;)</span></span>
<span id="cb44-15"><a href="usecases.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="usecases.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="do">## To reduce file size, pre-calculated RDA will be loaded</span></span>
<span id="cb44-17"><a href="usecases.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;../sc_data.rda&quot;</span>)</span></code></pre></div>
<p>Subsequently, we employ the scplot to plot the results of dimensionality reduction using UMAP.<br />
Among these, for the present study, we perform enrichment analysis on the marker genes of clusters 1 and 5.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="usecases.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scplot)</span>
<span id="cb45-2"><a href="usecases.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="do">## scplot utilizes scattermore for rendering, in this instance, we override the highlighting by geom_node_point.</span></span>
<span id="cb45-3"><a href="usecases.html#cb45-3" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">sc_dim</span>(pbmc) <span class="sc">+</span> </span>
<span id="cb45-4"><a href="usecases.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;1&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb45-5"><a href="usecases.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb45-6"><a href="usecases.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;5&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb45-7"><a href="usecases.html#cb45-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb45-8"><a href="usecases.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sc_dim_geom_label</span>(<span class="at">geom =</span> shadowtext<span class="sc">::</span>geom_shadowtext, </span>
<span id="cb45-9"><a href="usecases.html#cb45-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">bg.color=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb45-10"><a href="usecases.html#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="usecases.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clusterProfiler)</span>
<span id="cb45-12"><a href="usecases.html#cb45-12" aria-hidden="true" tabindex="-1"></a>marker_1 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;1&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-13"><a href="usecases.html#cb45-13" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb45-14"><a href="usecases.html#cb45-14" aria-hidden="true" tabindex="-1"></a>marker_5 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;5&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb45-15"><a href="usecases.html#cb45-15" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb45-16"><a href="usecases.html#cb45-16" aria-hidden="true" tabindex="-1"></a>mk1_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_1)</span>
<span id="cb45-17"><a href="usecases.html#cb45-17" aria-hidden="true" tabindex="-1"></a>mk5_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_5)</span></code></pre></div>
<p>Obtain the color information from <code>ggplot2</code> and obtain pathway using <code>ggkegg</code>. Here, we selected <code>Osteoclast differentiation (hsa04380)</code>, nodes are colored by <code>ggfx</code> according to the colors in the reduced dimension plot, and markers in both cluster are colored by the specified color (<code>tomato</code>). This facilitates the linkage between pathway information, such as KEGG, and single-cell analysis data, enabling the creation of intuitive and comprehensible visual representations.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="usecases.html#cb46-1" aria-hidden="true" tabindex="-1"></a>built <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(dd)<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb46-2"><a href="usecases.html#cb46-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> built<span class="sc">$</span>colour</span>
<span id="cb46-3"><a href="usecases.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(built<span class="sc">$</span>group)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb46-4"><a href="usecases.html#cb46-4" aria-hidden="true" tabindex="-1"></a>gr_cols <span class="ot">&lt;-</span> cols[<span class="sc">!</span><span class="fu">duplicated</span>(cols)]</span>
<span id="cb46-5"><a href="usecases.html#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="usecases.html#cb46-6" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa04380&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">marker_1=</span><span class="fu">append_cp</span>(mk1_enrich),</span>
<span id="cb46-7"><a href="usecases.html#cb46-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">marker_5=</span><span class="fu">append_cp</span>(mk5_enrich))</span>
<span id="cb46-8"><a href="usecases.html#cb46-8" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y)<span class="sc">+</span></span>
<span id="cb46-9"><a href="usecases.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb46-10"><a href="usecases.html#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_1<span class="sc">&amp;</span>marker_5),</span>
<span id="cb46-11"><a href="usecases.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 1 &amp; 5</span></span>
<span id="cb46-12"><a href="usecases.html#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb46-13"><a href="usecases.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb46-14"><a href="usecases.html#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_1<span class="sc">&amp;!</span>marker_5),</span>
<span id="cb46-15"><a href="usecases.html#cb46-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;1&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 1</span></span>
<span id="cb46-16"><a href="usecases.html#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;1&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb46-17"><a href="usecases.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb46-18"><a href="usecases.html#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_5<span class="sc">&amp;!</span>marker_1),</span>
<span id="cb46-19"><a href="usecases.html#cb46-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;5&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 5</span></span>
<span id="cb46-20"><a href="usecases.html#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;5&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb46-21"><a href="usecases.html#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlay_raw_map</span>(<span class="st">&quot;hsa04380&quot;</span>,</span>
<span id="cb46-22"><a href="usecases.html#cb46-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transparent_colors =</span> <span class="fu">c</span>(<span class="st">&quot;#cccccc&quot;</span>,<span class="st">&quot;#FFFFFF&quot;</span>,<span class="st">&quot;#BFBFFF&quot;</span>,<span class="st">&quot;#BFFFBF&quot;</span>))<span class="sc">+</span></span>
<span id="cb46-23"><a href="usecases.html#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb46-24"><a href="usecases.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;tmp.png&quot;</span>,</span>
<span id="cb46-25"><a href="usecases.html#cb46-25" aria-hidden="true" tabindex="-1"></a>       gg<span class="sc">+</span>dd<span class="sc">+</span><span class="fu">plot_layout</span>(<span class="at">widths=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.3</span>)),</span>
<span id="cb46-26"><a href="usecases.html#cb46-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">20</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span>
<span id="cb46-27"><a href="usecases.html#cb46-27" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>()<span class="sc">+</span>cowplot<span class="sc">::</span><span class="fu">draw_image</span>(<span class="st">&quot;tmp.png&quot;</span>)</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/plot_sc-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Example for composing multiple pathways:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="usecases.html#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="usecases.html#cb47-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">sc_dim</span>(pbmc) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="usecases.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;1&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb47-4"><a href="usecases.html#cb47-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-5"><a href="usecases.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;5&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb47-6"><a href="usecases.html#cb47-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-7"><a href="usecases.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;4&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb47-8"><a href="usecases.html#cb47-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;gold&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-9"><a href="usecases.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(<span class="fu">geom_node_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span>UMAP_1, <span class="at">y=</span>UMAP_2, <span class="at">filter=</span>ident<span class="sc">==</span><span class="st">&quot;6&quot;</span>, <span class="at">color=</span>ident)),</span>
<span id="cb47-10"><a href="usecases.html#cb47-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colour=</span><span class="st">&quot;gold&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-11"><a href="usecases.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sc_dim_geom_label</span>(<span class="at">geom =</span> shadowtext<span class="sc">::</span>geom_shadowtext, </span>
<span id="cb47-12"><a href="usecases.html#cb47-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">bg.color=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb47-13"><a href="usecases.html#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="usecases.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clusterProfiler)</span>
<span id="cb47-15"><a href="usecases.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Hs.eg.db)</span>
<span id="cb47-16"><a href="usecases.html#cb47-16" aria-hidden="true" tabindex="-1"></a>marker_1 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;1&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-17"><a href="usecases.html#cb47-17" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb47-18"><a href="usecases.html#cb47-18" aria-hidden="true" tabindex="-1"></a>marker_5 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;5&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-19"><a href="usecases.html#cb47-19" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb47-20"><a href="usecases.html#cb47-20" aria-hidden="true" tabindex="-1"></a>marker_6 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;6&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-21"><a href="usecases.html#cb47-21" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb47-22"><a href="usecases.html#cb47-22" aria-hidden="true" tabindex="-1"></a>marker_4 <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">bitr</span>((markers <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span><span class="st">&quot;4&quot;</span> <span class="sc">&amp;</span> p_val_adj <span class="sc">&lt;</span> <span class="fl">1e-50</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-23"><a href="usecases.html#cb47-23" aria-hidden="true" tabindex="-1"></a>                                     dplyr<span class="sc">::</span><span class="fu">select</span>(gene))<span class="sc">$</span>gene,<span class="at">fromType=</span><span class="st">&quot;SYMBOL&quot;</span>,<span class="at">toType=</span><span class="st">&quot;ENTREZID&quot;</span>,<span class="at">OrgDb =</span> org.Hs.eg.db)<span class="sc">$</span>ENTREZID</span>
<span id="cb47-24"><a href="usecases.html#cb47-24" aria-hidden="true" tabindex="-1"></a>mk1_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_1)</span>
<span id="cb47-25"><a href="usecases.html#cb47-25" aria-hidden="true" tabindex="-1"></a>mk5_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_5)</span>
<span id="cb47-26"><a href="usecases.html#cb47-26" aria-hidden="true" tabindex="-1"></a>mk6_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_6)</span>
<span id="cb47-27"><a href="usecases.html#cb47-27" aria-hidden="true" tabindex="-1"></a>mk4_enrich <span class="ot">&lt;-</span> <span class="fu">enrichKEGG</span>(marker_4)</span>
<span id="cb47-28"><a href="usecases.html#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="usecases.html#cb47-29" aria-hidden="true" tabindex="-1"></a>built <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(dd)<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb47-30"><a href="usecases.html#cb47-30" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> built<span class="sc">$</span>colour</span>
<span id="cb47-31"><a href="usecases.html#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cols) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(built<span class="sc">$</span>group)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb47-32"><a href="usecases.html#cb47-32" aria-hidden="true" tabindex="-1"></a>gr_cols <span class="ot">&lt;-</span> cols[<span class="sc">!</span><span class="fu">duplicated</span>(cols)]</span>
<span id="cb47-33"><a href="usecases.html#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="usecases.html#cb47-34" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa04612&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">marker_4=</span><span class="fu">append_cp</span>(mk4_enrich),</span>
<span id="cb47-35"><a href="usecases.html#cb47-35" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">marker_6=</span><span class="fu">append_cp</span>(mk6_enrich))</span>
<span id="cb47-36"><a href="usecases.html#cb47-36" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g1, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y)<span class="sc">+</span></span>
<span id="cb47-37"><a href="usecases.html#cb47-37" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-38"><a href="usecases.html#cb47-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_4<span class="sc">&amp;</span>marker_6),</span>
<span id="cb47-39"><a href="usecases.html#cb47-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span><span class="st">&quot;gold&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb47-40"><a href="usecases.html#cb47-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="st">&quot;gold&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-41"><a href="usecases.html#cb47-41" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-42"><a href="usecases.html#cb47-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_4<span class="sc">&amp;!</span>marker_6),</span>
<span id="cb47-43"><a href="usecases.html#cb47-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;4&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb47-44"><a href="usecases.html#cb47-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;4&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-45"><a href="usecases.html#cb47-45" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-46"><a href="usecases.html#cb47-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_6<span class="sc">&amp;!</span>marker_4),</span>
<span id="cb47-47"><a href="usecases.html#cb47-47" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;6&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb47-48"><a href="usecases.html#cb47-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;6&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-49"><a href="usecases.html#cb47-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlay_raw_map</span>(<span class="st">&quot;hsa04612&quot;</span>,</span>
<span id="cb47-50"><a href="usecases.html#cb47-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transparent_colors =</span> <span class="fu">c</span>(<span class="st">&quot;#b3b3b3&quot;</span>,</span>
<span id="cb47-51"><a href="usecases.html#cb47-51" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;#cccccc&quot;</span>,</span>
<span id="cb47-52"><a href="usecases.html#cb47-52" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;#FFFFFF&quot;</span>,</span>
<span id="cb47-53"><a href="usecases.html#cb47-53" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;#BFBFFF&quot;</span>,</span>
<span id="cb47-54"><a href="usecases.html#cb47-54" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;#BFFFBF&quot;</span>))<span class="sc">+</span></span>
<span id="cb47-55"><a href="usecases.html#cb47-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb47-56"><a href="usecases.html#cb47-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-57"><a href="usecases.html#cb47-57" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">pathway</span>(<span class="st">&quot;hsa04380&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">marker_1=</span><span class="fu">append_cp</span>(mk1_enrich),</span>
<span id="cb47-58"><a href="usecases.html#cb47-58" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">marker_5=</span><span class="fu">append_cp</span>(mk5_enrich))</span>
<span id="cb47-59"><a href="usecases.html#cb47-59" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(g2, <span class="at">layout=</span><span class="st">&quot;manual&quot;</span>, <span class="at">x=</span>x, <span class="at">y=</span>y)<span class="sc">+</span></span>
<span id="cb47-60"><a href="usecases.html#cb47-60" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-61"><a href="usecases.html#cb47-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_1<span class="sc">&amp;</span>marker_5),</span>
<span id="cb47-62"><a href="usecases.html#cb47-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 1 &amp; 5</span></span>
<span id="cb47-63"><a href="usecases.html#cb47-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="st">&quot;tomato&quot;</span>, <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-64"><a href="usecases.html#cb47-64" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-65"><a href="usecases.html#cb47-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_1<span class="sc">&amp;!</span>marker_5),</span>
<span id="cb47-66"><a href="usecases.html#cb47-66" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;1&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 1</span></span>
<span id="cb47-67"><a href="usecases.html#cb47-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;1&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-68"><a href="usecases.html#cb47-68" aria-hidden="true" tabindex="-1"></a>  ggfx<span class="sc">::</span><span class="fu">with_outer_glow</span>(</span>
<span id="cb47-69"><a href="usecases.html#cb47-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_rect</span>(<span class="fu">aes</span>(<span class="at">filter=</span>marker_5<span class="sc">&amp;!</span>marker_1),</span>
<span id="cb47-70"><a href="usecases.html#cb47-70" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color=</span>gr_cols[<span class="st">&quot;5&quot;</span>], <span class="at">fill=</span><span class="st">&quot;white&quot;</span>), <span class="do">## Marker 5</span></span>
<span id="cb47-71"><a href="usecases.html#cb47-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span>gr_cols[<span class="st">&quot;5&quot;</span>], <span class="at">expand=</span><span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb47-72"><a href="usecases.html#cb47-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlay_raw_map</span>(<span class="st">&quot;hsa04380&quot;</span>,</span>
<span id="cb47-73"><a href="usecases.html#cb47-73" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transparent_colors =</span> <span class="fu">c</span>(<span class="st">&quot;#cccccc&quot;</span>,<span class="st">&quot;#FFFFFF&quot;</span>,<span class="st">&quot;#BFBFFF&quot;</span>,<span class="st">&quot;#BFFFBF&quot;</span>))<span class="sc">+</span></span>
<span id="cb47-74"><a href="usecases.html#cb47-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb47-75"><a href="usecases.html#cb47-75" aria-hidden="true" tabindex="-1"></a>left <span class="ot">&lt;-</span>  (gg2 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Marker 1 and 5&quot;</span>)) <span class="sc">/</span></span>
<span id="cb47-76"><a href="usecases.html#cb47-76" aria-hidden="true" tabindex="-1"></a> (gg1 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Marker 4 and 6&quot;</span>))</span>
<span id="cb47-77"><a href="usecases.html#cb47-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-78"><a href="usecases.html#cb47-78" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> left <span class="sc">+</span> dd <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design=</span><span class="st">&quot;</span></span>
<span id="cb47-79"><a href="usecases.html#cb47-79" aria-hidden="true" tabindex="-1"></a><span class="st">            AAAAA###</span></span>
<span id="cb47-80"><a href="usecases.html#cb47-80" aria-hidden="true" tabindex="-1"></a><span class="st">            AAAAACCC</span></span>
<span id="cb47-81"><a href="usecases.html#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="st">            BBBBBCCC</span></span>
<span id="cb47-82"><a href="usecases.html#cb47-82" aria-hidden="true" tabindex="-1"></a><span class="st">            BBBBB###</span></span>
<span id="cb47-83"><a href="usecases.html#cb47-83" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;</span>)</span>
<span id="cb47-84"><a href="usecases.html#cb47-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-85"><a href="usecases.html#cb47-85" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;tmp.png&quot;</span>,</span>
<span id="cb47-86"><a href="usecases.html#cb47-86" aria-hidden="true" tabindex="-1"></a>       final,</span>
<span id="cb47-87"><a href="usecases.html#cb47-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">15</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">dpi=</span><span class="dv">300</span>, <span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span>
<span id="cb47-88"><a href="usecases.html#cb47-88" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>()<span class="sc">+</span>cowplot<span class="sc">::</span><span class="fu">draw_image</span>(<span class="st">&quot;tmp.png&quot;</span>)</span></code></pre></div>
<p><img src="04-usecases_files/figure-html/plot_sc2-1.png" width="100%" style="display: block; margin: auto;" /></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ggkegg</strong>" was written by Noriaki Sato. It was last built on 2023-05-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
