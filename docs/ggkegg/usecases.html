<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Usecases | ggkegg</title>
<meta name="author" content="Noriaki Sato">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 5 Usecases | ggkegg">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Usecases | ggkegg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-J7N3J5H0G4"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-J7N3J5H0G4');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="5.1 Visualizing numerical attributes from DESeq2 By providing the results of the DESeq2 package, which is often used for transcriptome analysis, it is possible to reflect numerical results in the...">
<meta property="og:description" content="5.1 Visualizing numerical attributes from DESeq2 By providing the results of the DESeq2 package, which is often used for transcriptome analysis, it is possible to reflect numerical results in the...">
<meta name="twitter:description" content="5.1 Visualizing numerical attributes from DESeq2 By providing the results of the DESeq2 package, which is often used for transcriptome analysis, it is possible to reflect numerical results in the...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ggkegg</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="pathway.html"><span class="header-section-number">2</span> Pathway</a></li>
<li><a class="" href="module.html"><span class="header-section-number">3</span> Module</a></li>
<li><a class="" href="network.html"><span class="header-section-number">4</span> Network</a></li>
<li><a class="active" href="usecases.html"><span class="header-section-number">5</span> Usecases</a></li>
<li><a class="" href="notes.html"><span class="header-section-number">6</span> Notes</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="usecases" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Usecases<a class="anchor" aria-label="anchor" href="#usecases"><i class="fas fa-link"></i></a>
</h1>
<div id="visualizing-numerical-attributes-from-deseq2" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Visualizing numerical attributes from DESeq2<a class="anchor" aria-label="anchor" href="#visualizing-numerical-attributes-from-deseq2"><i class="fas fa-link"></i></a>
</h2>
<p>By providing the results of the DESeq2 package, which is often used for transcriptome analysis, it is possible to reflect numerical results in the nodes of a graph. The <code>assign_deseq2</code> function can be used for this purpose. By specifying the numerical value (e.g., <code>log2FoldChange</code>) that you want to reflect in the graph as the <code>column</code> argument, you can assign the value to the nodes. If multiple genes are hit, the <code>numeric_combine</code> argument specifies how to combine multiple values (the default is <code>mean</code>).</p>
<p>Here, we use a RNA-Seq dataset that analyzed the transcriptome changes in human urothelial cells infected with BK polyomavirus (<a href="https://doi.org/10.1038/s41388-022-02235-8">Baker et al. 2022</a>). The raw sequences obtained from Sequence Read Archive were processed by <a href="https://nf-co.re/rnaseq">nf-core</a>, and subsequently analyzed using <code>tximport</code>, <code>salmon</code> and <code>DESeq2</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noriakis/ggkegg">ggkegg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thelovelab/DESeq2">DESeq2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The file stores DESeq() result on transcriptomic dataset deposited by Baker et al. 2022.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"uro.deseq.res.rda"</span><span class="op">)</span> </span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt; class: DESeqDataSet </span></span>
<span><span class="co">#&gt; dim: 29744 26 </span></span>
<span><span class="co">#&gt; metadata(1): version</span></span>
<span><span class="co">#&gt; assays(8): counts avgTxLength ... replaceCounts</span></span>
<span><span class="co">#&gt;   replaceCooks</span></span>
<span><span class="co">#&gt; rownames(29744): A1BG A1BG-AS1 ... ZZEF1 ZZZ3</span></span>
<span><span class="co">#&gt; rowData names(27): baseMean baseVar ... maxCooks</span></span>
<span><span class="co">#&gt;   replace</span></span>
<span><span class="co">#&gt; colnames(26): SRR14509882 SRR14509883 ... SRR14509906</span></span>
<span><span class="co">#&gt;   SRR14509907</span></span>
<span><span class="co">#&gt; colData names(27): Assay.Type AvgSpotLen ...</span></span>
<span><span class="co">#&gt;   viral_infection replaceable</span></span>
<span><span class="va">vinf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/results.html">results</a></span><span class="op">(</span><span class="va">res</span>, contrast<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"viral_infection"</span>,<span class="st">"BKPyV (Dunlop) MOI=1"</span>,<span class="st">"No infection"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## LFC</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04110"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deseq2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/assign_deseq2.html">assign_deseq2</a></span><span class="op">(</span><span class="va">vinf</span><span class="op">)</span>,</span>
<span>                                   padj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/assign_deseq2.html">assign_deseq2</a></span><span class="op">(</span><span class="va">vinf</span>, column<span class="op">=</span><span class="st">"padj"</span><span class="op">)</span>,</span>
<span>                                   converted_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"hsa"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'mm'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 start_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'cm'</span><span class="op">)</span>,</span>
<span>                 end_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">'cm'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">deseq2</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">converted_name</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">!=</span><span class="st">"group"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"white"</span>, expand<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"blue"</span>,high<span class="op">=</span><span class="st">"red"</span>, name<span class="op">=</span><span class="st">"LFC"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/deseq2-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Adjusted p-values</span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'mm'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 start_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'cm'</span><span class="op">)</span>,</span>
<span>                 end_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">'cm'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">padj</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">converted_name</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">!=</span><span class="st">"group"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"white"</span>, expand<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"padj"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/deseq2-2.png" width="100%" style="display: block; margin: auto;"></div>
<div id="using-ggfx-to-further-customize-the-visualization" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> using <code>ggfx</code> to further customize the visualization<a class="anchor" aria-label="anchor" href="#using-ggfx-to-further-customize-the-visualization"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Highlighting differentially expressed genes at adjusted p-values &lt; 0.05 with coloring of adjusted p-values on raw KEGG map</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">padj</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">padj</span>, filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">padj</span><span class="op">&lt;</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        colour<span class="op">=</span><span class="st">"yellow"</span>, expand<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04110"</span>, transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#cccccc"</span>,<span class="st">"#FFFFFF"</span>,<span class="st">"#BFBFFF"</span>,<span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"pink"</span>,high<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gg</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/deseq2_2-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="using-multiple-geoms-to-add-information" class="section level3" number="5.1.2">
<h3>
<span class="header-section-number">5.1.2</span> using multiple geoms to add information<a class="anchor" aria-label="anchor" href="#using-multiple-geoms-to-add-information"><i class="fas fa-link"></i></a>
</h3>
<p>You can use your favorite geoms in <code>ggplot2</code> and their extensions to add information. In this example, We add log2 fold changes as contour using <a href="https://github.com/AllanCameron/geomtextpath"><code>geomtextpath</code></a>, and customized the font using <a href="https://github.com/IdreesInc/Monocraft/"><code>Monocraft</code></a>.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lfc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/assign_deseq2.html">assign_deseq2</a></span><span class="op">(</span><span class="va">vinf</span>, column<span class="op">=</span><span class="st">"log2FoldChange"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Make contour data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lfc</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">cont</span> <span class="op">&lt;-</span> <span class="fu">akima</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/akima/man/interp2xyz.html">interp2xyz</a></span><span class="op">(</span><span class="fu">interp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/interp/man/interp.html">interp</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span>, <span class="va">df</span><span class="op">$</span><span class="va">y</span>, <span class="va">df</span><span class="op">$</span><span class="va">lfc</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## </span></span>
<span><span class="fu">sysfonts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add.html">font_add</a></span><span class="op">(</span>family<span class="op">=</span><span class="st">"monocraft"</span>,regular<span class="op">=</span><span class="st">"Monocraft.ttf"</span><span class="op">)</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span>arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span>,</span>
<span>                       end_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">7.5</span>,<span class="st">"mm"</span><span class="op">)</span>,</span>
<span>                       alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geomtextpath</span><span class="fu">::</span><span class="fu"><a href="https://allancameron.github.io/geomtextpath/reference/geom_textcontour.html">geom_textcontour</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, z<span class="op">=</span><span class="va">z</span>,color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   size<span class="op">=</span><span class="fl">3</span>, linetype<span class="op">=</span><span class="fl">2</span>,</span>
<span>                                   linewidth<span class="op">=</span><span class="fl">0.1</span>, data<span class="op">=</span><span class="va">cont</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">padj</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">padj</span>, filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">padj</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">padj</span><span class="op">&lt;</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          colour<span class="op">=</span><span class="st">"yellow"</span>, expand<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">converted_name</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"monocraft"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>                          high<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>                          name<span class="op">=</span><span class="st">"LFC"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"Edge type"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"pink"</span>,high<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gg</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/deseq2_3-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="integrating-numeric-values-onto-tbl_graph" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Integrating numeric values onto <code>tbl_graph</code><a class="anchor" aria-label="anchor" href="#integrating-numeric-values-onto-tbl_graph"><i class="fas fa-link"></i></a>
</h2>
<div id="integrating-numeric-vector-to-tbl_graph" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Integrating numeric vector to <code>tbl_graph</code><a class="anchor" aria-label="anchor" href="#integrating-numeric-vector-to-tbl_graph"><i class="fas fa-link"></i></a>
</h3>
<p>Numerical values can be reflected in node or edge tables, utilizing either the <code>node_numeric</code> or <code>edge_numeric</code> functions. The input can be a named vector or a tibble containing id and value columns.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hsa:51343"</span><span class="op">)</span></span>
<span><span class="va">new_g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>num<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/node_numeric.html">node_numeric</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_g</span></span>
<span><span class="co">#&gt; # A tbl_graph: 134 nodes and 157 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed acyclic multigraph with 40 components</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A tibble: 134 × 23</span></span>
<span><span class="co">#&gt;   name        type  reaction graphics_name     x     y width</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 hsa:1029    gene  &lt;NA&gt;     CDKN2A, ARF,…   532  -218    46</span></span>
<span><span class="co">#&gt; 2 hsa:51343   gene  &lt;NA&gt;     FZR1, CDC20C…   981  -630    46</span></span>
<span><span class="co">#&gt; 3 hsa:4171 h… gene  &lt;NA&gt;     MCM2, BM28, …   553  -681    46</span></span>
<span><span class="co">#&gt; 4 hsa:23594 … gene  &lt;NA&gt;     ORC6, ORC6L.…   494  -681    46</span></span>
<span><span class="co">#&gt; 5 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -392    46</span></span>
<span><span class="co">#&gt; 6 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -613    46</span></span>
<span><span class="co">#&gt; # ℹ 128 more rows</span></span>
<span><span class="co">#&gt; # ℹ 16 more variables: height &lt;dbl&gt;, fgcolor &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   bgcolor &lt;chr&gt;, graphics_type &lt;chr&gt;, coords &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   xmin &lt;dbl&gt;, xmax &lt;dbl&gt;, ymin &lt;dbl&gt;, ymax &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   orig.id &lt;chr&gt;, pathway_id &lt;chr&gt;, deseq2 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   padj &lt;dbl&gt;, converted_name &lt;chr&gt;, lfc &lt;dbl&gt;, num &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A tibble: 157 × 6</span></span>
<span><span class="co">#&gt;    from    to type  subtype_name    subtype_value pathway_id</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1   118    39 GErel expression      --&gt;           hsa04110  </span></span>
<span><span class="co">#&gt; 2    50    61 PPrel inhibition      --|           hsa04110  </span></span>
<span><span class="co">#&gt; 3    50    61 PPrel phosphorylation +p            hsa04110  </span></span>
<span><span class="co">#&gt; # ℹ 154 more rows</span></span></code></pre></div>
</div>
<div id="integrating-matrix-to-tbl_graph" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Integrating matrix to <code>tbl_graph</code><a class="anchor" aria-label="anchor" href="#integrating-matrix-to-tbl_graph"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to reflect an expression matrix in a graph, the <code>edge_matrix</code> and <code>node_matrix</code> functions can be useful. By specifying a matrix and gene IDs, you can assign numeric values for each sample to the <code>tbl_graph</code>. <code>edge_matrix</code> assigns the sum of the two nodes connected by an edge, ignoring group nodes (<a href="https://doi.org/10.1186/s12859-020-03692-2">Adnan et al. 2020</a>).</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html">assay</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/vst.html">vst</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/edge_matrix.html">edge_matrix</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/node_matrix.html">node_matrix</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span>
<span><span class="va">new_g</span></span>
<span><span class="co">#&gt; # A tbl_graph: 134 nodes and 157 edges</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A directed acyclic multigraph with 40 components</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A tibble: 134 × 48</span></span>
<span><span class="co">#&gt;   name        type  reaction graphics_name     x     y width</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 hsa:1029    gene  &lt;NA&gt;     CDKN2A, ARF,…   532  -218    46</span></span>
<span><span class="co">#&gt; 2 hsa:51343   gene  &lt;NA&gt;     FZR1, CDC20C…   981  -630    46</span></span>
<span><span class="co">#&gt; 3 hsa:4171 h… gene  &lt;NA&gt;     MCM2, BM28, …   553  -681    46</span></span>
<span><span class="co">#&gt; 4 hsa:23594 … gene  &lt;NA&gt;     ORC6, ORC6L.…   494  -681    46</span></span>
<span><span class="co">#&gt; 5 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -392    46</span></span>
<span><span class="co">#&gt; 6 hsa:10393 … gene  &lt;NA&gt;     ANAPC10, APC…   981  -613    46</span></span>
<span><span class="co">#&gt; # ℹ 128 more rows</span></span>
<span><span class="co">#&gt; # ℹ 41 more variables: height &lt;dbl&gt;, fgcolor &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   bgcolor &lt;chr&gt;, graphics_type &lt;chr&gt;, coords &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   xmin &lt;dbl&gt;, xmax &lt;dbl&gt;, ymin &lt;dbl&gt;, ymax &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   orig.id &lt;chr&gt;, pathway_id &lt;chr&gt;, deseq2 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   padj &lt;dbl&gt;, converted_name &lt;chr&gt;, lfc &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509882 &lt;dbl&gt;, SRR14509883 &lt;dbl&gt;, …</span></span>
<span><span class="co">#&gt; #</span></span>
<span><span class="co">#&gt; # A tibble: 157 × 34</span></span>
<span><span class="co">#&gt;    from    to type  subtype_name    subtype_value pathway_id</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1   118    39 GErel expression      --&gt;           hsa04110  </span></span>
<span><span class="co">#&gt; 2    50    61 PPrel inhibition      --|           hsa04110  </span></span>
<span><span class="co">#&gt; 3    50    61 PPrel phosphorylation +p            hsa04110  </span></span>
<span><span class="co">#&gt; # ℹ 154 more rows</span></span>
<span><span class="co">#&gt; # ℹ 28 more variables: from_nd &lt;chr&gt;, to_nd &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509882 &lt;dbl&gt;, SRR14509883 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509884 &lt;dbl&gt;, SRR14509885 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509886 &lt;dbl&gt;, SRR14509887 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509888 &lt;dbl&gt;, SRR14509889 &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   SRR14509890 &lt;dbl&gt;, SRR14509891 &lt;dbl&gt;, …</span></span></code></pre></div>
<div id="values-to-edge" class="section level4" number="5.2.2.1">
<h4>
<span class="header-section-number">5.2.2.1</span> Values to edge<a class="anchor" aria-label="anchor" href="#values-to-edge"><i class="fas fa-link"></i></a>
</h4>
<p>The same effect of <code>edge_matrix</code> can be obtained by <code>edge_numeric_sum</code>, using named numeric vector as input. This function adds edge values based on node values. The below example shows combining LFCs to edges. This is different behaviour from <code>edge_numeric</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Numeric vector (name is SYMBOL)</span></span>
<span><span class="va">vinflfc</span> <span class="op">&lt;-</span> <span class="va">vinf</span><span class="op">$</span><span class="va">log2FoldChange</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">vinf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co">## Use graphics_name to merge</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>grname<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">graphics_name</span>, <span class="st">","</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="st">"["</span>, <span class="fl">1</span>, FUN.VALUE<span class="op">=</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>summed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/edge_numeric_sum.html">edge_numeric_sum</a></span><span class="op">(</span><span class="va">vinflfc</span>, name<span class="op">=</span><span class="st">"grname"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">summed</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, deg<span class="op">=</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_degree</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">deg</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span>layout<span class="op">=</span><span class="st">"nicely"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">summed</span>, width<span class="op">=</span><span class="va">summed</span>,</span>
<span>                         linetype<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span>,</span>
<span>                     arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     start_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">2</span>,<span class="st">"mm"</span><span class="op">)</span>,</span>
<span>                     end_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">2</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">bgcolor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">grname</span>,</span>
<span>                     filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span>,</span>
<span>                 repel<span class="op">=</span><span class="cn">TRUE</span>, bg.colour<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_width.html">scale_edge_width</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"blue"</span>, high<span class="op">=</span><span class="st">"red"</span>, name<span class="op">=</span><span class="st">"Edge"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/ens-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
</div>
<div id="visualizing-multiple-enrichment-results" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Visualizing multiple enrichment results<a class="anchor" aria-label="anchor" href="#visualizing-multiple-enrichment-results"><i class="fas fa-link"></i></a>
</h2>
<p>You can visualize the results of multiple enrichment analyses. Similar to using the <code>ggkegg</code> function with the <code>enrichResult</code> class, there is an <code>append_cp</code> function that can be used within the <code>mutate</code> function. By providing an <code>enrichResult</code> object to this function, if the pathway being visualized is present in the result, the gene information within the pathway can be reflected in the graph. In this example, in addition to the changes in urothelial cells mentioned above, changes in renal proximal tubular epithelial cells are being compared (<a href="https://doi.org/10.1128/mbio.00903-16">Assetta et al. 2016</a>).</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## These are RDAs storing DEGs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"degListRPTEC.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"degURO.rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span>;</span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/biomedical-knowledge-mining-book/">clusterProfiler</a></span><span class="op">)</span>;</span>
<span><span class="va">input_uro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="va">uroUp</span>, <span class="co">## DEGs in urothelial cells</span></span>
<span>              fromType <span class="op">=</span> <span class="st">"SYMBOL"</span>,</span>
<span>              toType <span class="op">=</span> <span class="st">"ENTREZID"</span>,</span>
<span>              OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">input_rptec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="va">gls</span><span class="op">$</span><span class="va">day3_up_rptec</span>, <span class="co">## DEGs at 3 days post infection in RPTECs</span></span>
<span>              fromType <span class="op">=</span> <span class="st">"SYMBOL"</span>,</span>
<span>              toType <span class="op">=</span> <span class="st">"ENTREZID"</span>,</span>
<span>              OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span></span>
<span><span class="va">ekuro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="va">input_uro</span><span class="op">)</span></span>
<span><span class="va">ekrptec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="va">input_rptec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04110"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uro<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">ekuro</span>, how<span class="op">=</span><span class="st">"all"</span><span class="op">)</span>,</span>
<span>                                    rptec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">ekrptec</span>, how<span class="op">=</span><span class="st">"all"</span><span class="op">)</span>,</span>
<span>                                    converted_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"hsa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g1</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'mm'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 start_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'cm'</span><span class="op">)</span>,</span>
<span>                 end_cap <span class="op">=</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">square</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">'cm'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">uro</span>, xmax<span class="op">=</span><span class="va">x</span>,  filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">rptec</span>, xmin<span class="op">=</span><span class="va">x</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>,<span class="st">"tomato"</span><span class="op">)</span>, name<span class="op">=</span><span class="st">"urothelial|rptec"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">converted_name</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">!=</span><span class="st">"group"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"white"</span>, expand<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/multcp-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>We can combine multiple plots combining <code>rawMap</code> by <code>patchwork</code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/rawMap.html">rawMap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ekuro</span>, <span class="va">ekrptec</span><span class="op">)</span>, fill_color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tomato"</span>,<span class="st">"tomato"</span><span class="op">)</span>, pid<span class="op">=</span><span class="st">"hsa04110"</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/rawMap.html">rawMap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ekuro</span>, <span class="va">ekrptec</span><span class="op">)</span>, fill_color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tomato"</span>,<span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>  pid<span class="op">=</span><span class="st">"hsa03460"</span><span class="op">)</span></span>
<span><span class="va">comb</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/multcp1_5-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>The example below applies a similar reflection to the Raw KEGG map and highlights genes that show statistically significant changes under both conditions using <code>ggfx</code> in yellow outer glow, with composing <code>dotplot</code> produced by clusterProfiler for the enrichment results by <code>patchwork</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">right</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/enrichplot/man/dotplot.html">dotplot</a></span><span class="op">(</span><span class="va">ekuro</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Urothelial"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/enrichplot/man/dotplot.html">dotplot</a></span><span class="op">(</span><span class="va">ekrptec</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"RPTECs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa03410"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uro<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">ekuro</span>, how<span class="op">=</span><span class="st">"all"</span><span class="op">)</span>,</span>
<span>        rptec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">ekrptec</span>, how<span class="op">=</span><span class="st">"all"</span><span class="op">)</span>,</span>
<span>        converted_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"hsa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g1</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">uro</span><span class="op">&amp;</span><span class="va">rptec</span><span class="op">)</span>,</span>
<span>                   color<span class="op">=</span><span class="st">"gold"</span>, fill<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">5</span>, sigma<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">uro</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">rptec</span>, xmin<span class="op">=</span><span class="va">x</span>, filter<span class="op">=</span><span class="va">type</span><span class="op">==</span><span class="st">"gene"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa03410"</span>, transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#cccccc"</span>,<span class="st">"#FFFFFF"</span>,<span class="st">"#BFBFFF"</span>,<span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"steelblue"</span>,<span class="st">"tomato"</span><span class="op">)</span>,</span>
<span>                    name<span class="op">=</span><span class="st">"urothelial|rptec"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gg2</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> <span class="va">right</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>design<span class="op">=</span><span class="st">"</span></span>
<span><span class="st">AAAA###</span></span>
<span><span class="st">AAAABBB</span></span>
<span><span class="st">AAAABBB</span></span>
<span><span class="st">AAAA###</span></span>
<span><span class="st">"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gg2</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/multcp2-1.png" width="100%" style="display: block; margin: auto;"></div>
<div id="multiple-enrichment-analysis-results-across-multiple-pathways" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Multiple enrichment analysis results across multiple pathways<a class="anchor" aria-label="anchor" href="#multiple-enrichment-analysis-results-across-multiple-pathways"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to native layouts, it is sometimes useful to show the interesting genes e.g. DEGs across multiple pathways. Here, we use <a href="https://github.com/GuangchuangYu/scatterpie"><code>scatterpie</code></a> library for visualization of multiple enrichment analysis results across multiple pathways.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scatterpie</span><span class="op">)</span></span>
<span><span class="co">## Obtain enrichment analysis results</span></span>
<span><span class="va">entrezid</span> <span class="op">&lt;-</span> <span class="va">uroUp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="st">"SYMBOL"</span>,<span class="st">"ENTREZID"</span>,<span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">entrezid</span><span class="op">$</span><span class="va">ENTREZID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">entrezid2</span> <span class="op">&lt;-</span> <span class="va">gls</span><span class="op">$</span><span class="va">day3_up_rptec</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="st">"SYMBOL"</span>,<span class="st">"ENTREZID"</span>,<span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="va">cp2</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">entrezid2</span><span class="op">$</span><span class="va">ENTREZID</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Filter to interesting pathways</span></span>
<span><span class="va">include</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pathways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span><span class="op">[</span><span class="va">include</span>,<span class="st">"ID"</span><span class="op">]</span></span>
<span><span class="va">pathways</span></span>
<span><span class="co">#&gt; [1] "hsa04110" "hsa03460" "hsa03440"</span></span></code></pre></div>
<p>We obtain multiple pathway data (the function returns the native coordinates but we ignore them).</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/multi_pathway_native.html">multi_pathway_native</a></span><span class="op">(</span><span class="va">pathways</span>, row_num<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>new_name<span class="op">=</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">name</span><span class="op">==</span><span class="st">"undefined"</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">name</span>,<span class="st">"_"</span>,<span class="va">pathway_id</span>,<span class="st">"_"</span>,<span class="va">orig.id</span><span class="op">)</span>,</span>
<span>                           <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">to_contracted</span>, <span class="va">new_name</span>, simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_vec</a></span><span class="op">(</span><span class="va">.orig_data</span>,<span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pid1 <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">.orig_data</span>,<span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"pathway_id"</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hsa03440 <span class="op">=</span> <span class="fu">purrr</span><span class="fu">:::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">pid1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">"hsa03440"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">$</span><span class="va">pathway_id</span><span class="op">)</span> ,</span>
<span>         hsa04110 <span class="op">=</span> <span class="fu">purrr</span><span class="fu">:::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">pid1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">"hsa04110"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">$</span><span class="va">pathway_id</span><span class="op">)</span>,</span>
<span>         hsa03460 <span class="op">=</span> <span class="fu">purrr</span><span class="fu">:::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">pid1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">"hsa03460"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">$</span><span class="va">pathway_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nds</span> <span class="op">&lt;-</span> <span class="va">g2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">eds</span> <span class="op">&lt;-</span> <span class="va">g2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rmdup_eds</span> <span class="op">&lt;-</span> <span class="va">eds</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">eds</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from"</span>,<span class="st">"to"</span>,<span class="st">"subtype_name"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">g2_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html">tbl_graph</a></span><span class="op">(</span>nodes<span class="op">=</span><span class="va">nds</span>, edges<span class="op">=</span><span class="va">rmdup_eds</span><span class="op">)</span></span>
<span><span class="va">g2_2</span> <span class="op">&lt;-</span> <span class="va">g2_2</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    in_pathway_uro<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">cp</span>, pid<span class="op">=</span><span class="va">include</span>,name<span class="op">=</span><span class="st">"new_name"</span><span class="op">)</span>,</span>
<span>    x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>   in_pathway_rptec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">cp2</span>, pid<span class="op">=</span><span class="va">include</span>,name <span class="op">=</span> <span class="st">"new_name"</span><span class="op">)</span>,</span>
<span>   id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"hsa"</span>,name <span class="op">=</span> <span class="st">"new_name"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_subgraph</span>, <span class="va">type</span><span class="op">!=</span><span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>deg<span class="op">=</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_degree</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">deg</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Here, we additionally assign graph-based clustering results to the graph, and we scale the size of the nodes so that the nodes can be visualized by scatterpie.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r.igraph.org/reference/V.html">V</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">walktrap</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/cluster_walktrap.html">walktrap.community</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span></span>
<span></span>
<span><span class="co">## Scale the node size</span></span>
<span><span class="va">sizeMin</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">sizeMax</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">rawMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html">V</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">deg</span><span class="op">)</span></span>
<span><span class="va">rawMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html">V</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">deg</span><span class="op">)</span></span>
<span><span class="va">scf</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sizeMax</span><span class="op">-</span><span class="va">sizeMin</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">rawMax</span><span class="op">-</span><span class="va">rawMin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html">V</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="va">scf</span> <span class="op">*</span> <span class="fu"><a href="https://r.igraph.org/reference/V.html">V</a></span><span class="op">(</span><span class="va">g2_2</span><span class="op">)</span><span class="op">$</span><span class="va">deg</span> <span class="op">+</span> <span class="va">sizeMin</span> <span class="op">-</span> <span class="va">scf</span> <span class="op">*</span> <span class="va">rawMin</span></span>
<span></span>
<span></span>
<span><span class="co">## Make base graph</span></span>
<span><span class="va">g3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g2_2</span>, layout<span class="op">=</span><span class="st">"nicely"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_parallel.html">geom_edge_parallel</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span>                 arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">subtype_name</span><span class="op">)</span>,</span>
<span>                 start_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">3</span>,<span class="st">"mm"</span><span class="op">)</span>,</span>
<span>                 end_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">8</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Edge type"</span><span class="op">)</span></span>
<span><span class="va">graphdata</span> <span class="op">&lt;-</span> <span class="va">g3</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<p>Finally, we use <code>geom_scatterpie</code> for the visualization. The background scatterpie indicates whether the genes are in the pathways, and the foreground indicates whether the gene is differentially expressed in multiple datasets. We highlight the genes which were differentially expressed in both datasets by gold colour.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g4</span> <span class="op">&lt;-</span> <span class="va">g3</span><span class="op">+</span></span>
<span>  <span class="fu">ggforce</span><span class="fu">::</span><span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_mark_rect.html">geom_mark_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, group<span class="op">=</span><span class="va">walktrap</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scatterpie/man/geom_scatterpie.html">geom_scatterpie</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, r<span class="op">=</span><span class="va">size</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  color<span class="op">=</span><span class="st">"transparent"</span>,</span>
<span>                  legend_name<span class="op">=</span><span class="st">"Pathway"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">graphdata</span>,</span>
<span>                  cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hsa04110"</span>, <span class="st">"hsa03440"</span>,<span class="st">"hsa03460"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scatterpie/man/geom_scatterpie.html">geom_scatterpie</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, r<span class="op">=</span><span class="va">size</span><span class="op">)</span>,</span>
<span>                           color<span class="op">=</span><span class="st">"transparent"</span>,</span>
<span>                           data<span class="op">=</span><span class="va">graphdata</span>, legend_name<span class="op">=</span><span class="st">"enrich"</span>,</span>
<span>                           cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"in_pathway_rptec"</span>,<span class="st">"in_pathway_uro"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/scatterpie/man/geom_scatterpie.html">geom_scatterpie</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, r<span class="op">=</span><span class="va">size</span><span class="op">)</span>,</span>
<span>                  color<span class="op">=</span><span class="st">"transparent"</span>,</span>
<span>                  data<span class="op">=</span><span class="va">graphdata</span><span class="op">[</span><span class="va">graphdata</span><span class="op">$</span><span class="va">in_pathway_rptec</span> <span class="op">&amp;</span> <span class="va">graphdata</span><span class="op">$</span><span class="va">in_pathway_uro</span>,<span class="op">]</span>,</span>
<span>                  cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"in_pathway_rptec"</span>,<span class="st">"in_pathway_uro"</span><span class="op">)</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">19</span>, size<span class="op">=</span><span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="op">!</span><span class="va">in_pathway_uro</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">in_pathway_rptec</span> <span class="op">&amp;</span> <span class="va">type</span><span class="op">!=</span><span class="st">"map"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_shadowtext.html">geom_node_shadowtext</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">id</span>, y<span class="op">=</span><span class="va">y</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">3</span>, family<span class="op">=</span><span class="st">"sans"</span>, bg.colour<span class="op">=</span><span class="st">"white"</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g4</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/final_scatterpie-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="projecting-the-gene-regulatory-networks-on-kegg-map" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Projecting the gene regulatory networks on KEGG map<a class="anchor" aria-label="anchor" href="#projecting-the-gene-regulatory-networks-on-kegg-map"><i class="fas fa-link"></i></a>
</h2>
<p>With this package, it is possible to project inferred networks such as gene regulatory networks or KO networks inferred by other software onto KEGG maps. The following is an example of projecting a subset of KO networks within a pathway inferred by CBNplot onto the reference map of the corresponding pathway using <code>MicrobiomeProfiler</code>. Of course, it is also possible to project networks created using other methods.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CBNplot</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noriakis/ggkegg">ggkegg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/MicrobiomeProfiler/">MicrobiomeProfiler</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Rat_data</span><span class="op">)</span></span>
<span><span class="va">ko.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MicrobiomeProfiler/man/enrichKO.html">enrichKO</a></span><span class="op">(</span><span class="va">Rat_data</span><span class="op">)</span></span>
<span><span class="va">exp.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">910</span><span class="op">)</span><span class="op">)</span>, <span class="fl">91</span>, <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">set_rownames</a></span><span class="op">(</span>value<span class="op">=</span><span class="va">Rat_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">set_colnames</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'S'</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">returnnet</span> <span class="op">&lt;-</span> <span class="fu">bngeneplot</span><span class="op">(</span><span class="va">ko.res</span>, exp<span class="op">=</span><span class="va">exp.dat</span>, pathNum<span class="op">=</span><span class="fl">1</span>, orgDb<span class="op">=</span><span class="cn">NULL</span>,returnNet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"ko00650"</span><span class="op">)</span></span>
<span><span class="va">joined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/combine_with_bnlearn.html">combine_with_bnlearn</a></span><span class="op">(</span><span class="va">pg</span>, <span class="va">returnnet</span><span class="op">$</span><span class="va">str</span>, <span class="va">returnnet</span><span class="op">$</span><span class="va">av</span><span class="op">)</span></span></code></pre></div>
<p>Plot the resulting map. In this example, the strength estimated by <code>CBNplot</code> is first displayed with colored edges, and then the edges of the reference graph are drawn in black on top of it. Also, edges included in both graphs are highlighted by yellow.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Summarize duplicate edges including `strength` attribute</span></span>
<span><span class="va">number</span> <span class="op">&lt;-</span> <span class="va">joined</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">from</span>,<span class="va">to</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, incstr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Annotate them</span></span>
<span><span class="va">joined</span> <span class="op">&lt;-</span> <span class="va">joined</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>both<span class="op">=</span><span class="va">n</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">&amp;</span><span class="va">incstr</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">joined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>convertKO<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"ko"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span>,</span>
<span>                              color<span class="op">=</span><span class="va">strength</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">both</span>,</span>
<span>                                  color<span class="op">=</span><span class="va">strength</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"yellow"</span>, sigma<span class="op">=</span><span class="fl">1</span>, expand<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"blue"</span>,high<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">convertKO</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">":"</span>, <span class="va">graphics_name</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">graphics_name</span>, <span class="st">":"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="st">"["</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">graphics_name</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">type</span><span class="op">==</span><span class="st">"map"</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"serif"</span>,</span>
<span>                 size<span class="op">=</span><span class="fl">2</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/konetplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<div id="projection-on-to-the-raw-kegg-map" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Projection on to the raw KEGG map<a class="anchor" aria-label="anchor" href="#projection-on-to-the-raw-kegg-map"><i class="fas fa-link"></i></a>
</h3>
<p>You can directly project the inferred network onto the raw PATHWAY map, which enables direct comparison of the knowledge of curated database and inferred network from your own dataset.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raws</span> <span class="op">&lt;-</span> <span class="va">joined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">strength</span><span class="op">)</span>,</span>
<span>                                color<span class="op">=</span><span class="va">strength</span><span class="op">)</span>,</span>
<span>                 linetype<span class="op">=</span><span class="fl">1</span>,</span>
<span>                 arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,<span class="st">"mm"</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"closed"</span><span class="op">)</span>,</span>
<span>                 end_cap<span class="op">=</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geometry.html">circle</a></span><span class="op">(</span><span class="fl">5</span>,<span class="st">"mm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_gradient2</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span>transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#ffffff"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">raws</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/konetplotmap-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="analyzing-cluster-marker-genes-in-single-cell-transcriptomics" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Analyzing cluster marker genes in single-cell transcriptomics<a class="anchor" aria-label="anchor" href="#analyzing-cluster-marker-genes-in-single-cell-transcriptomics"><i class="fas fa-link"></i></a>
</h2>
<p>This package can also be applied to single-cell analysis. As an example, consider mapping marker genes between clusters onto KEGG pathways and plotting them together with reduced dimension plots. Here, we use the <code>Seurat</code> package. We conduct a fundamental analysis.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># dir = "../filtered_gene_bc_matrices/hg19"</span></span>
<span><span class="co"># pbmc.data &lt;- Read10X(data.dir = dir)</span></span>
<span><span class="co"># pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = "pbmc3k",</span></span>
<span><span class="co">#                            min.cells=3, min.features=200)</span></span>
<span><span class="co"># pbmc &lt;- NormalizeData(pbmc)</span></span>
<span><span class="co"># pbmc &lt;- FindVariableFeatures(pbmc, selection.method = "vst")</span></span>
<span><span class="co"># pbmc &lt;- ScaleData(pbmc, features = row.names(pbmc))</span></span>
<span><span class="co"># pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc))</span></span>
<span><span class="co"># pbmc &lt;- FindNeighbors(pbmc, dims = 1:10, verbose = FALSE)</span></span>
<span><span class="co"># pbmc &lt;- FindClusters(pbmc, resolution = 0.5, verbose = FALSE)</span></span>
<span><span class="co"># markers &lt;- FindAllMarkers(pbmc)</span></span>
<span><span class="co"># save(pbmc, markers, file="../sc_data.rda")</span></span>
<span></span>
<span><span class="co">## To reduce file size, pre-calculated RDA will be loaded</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"../sc_data.rda"</span><span class="op">)</span></span></code></pre></div>
<p>Subsequently, we plot the results of dimensionality reduction by PCA.<br>
Among these, for the present study, we perform enrichment analysis on the marker genes of clusters 1 and 5.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/biomedical-knowledge-mining-book/">clusterProfiler</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Directly access slots in Seurat</span></span>
<span><span class="va">pcas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span><span class="op">@</span><span class="va">reductions</span><span class="op">$</span><span class="va">pca</span><span class="op">@</span><span class="va">cell.embeddings</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="va">pbmc</span><span class="op">@</span><span class="va">reductions</span><span class="op">$</span><span class="va">pca</span><span class="op">@</span><span class="va">cell.embeddings</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="va">pbmc</span><span class="op">@</span><span class="va">active.ident</span>,</span>
<span>    <span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PC_1"</span>,<span class="st">"PC_2"</span>,<span class="st">"Cell"</span>,<span class="st">"group"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aa</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pcas</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Cell</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>meanX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">PC_1</span><span class="op">)</span>, meanY<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">PC_2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Cell</span>, <span class="va">meanX</span>, <span class="va">meanY</span><span class="op">)</span></span>
<span><span class="va">label</span> <span class="op">&lt;-</span> <span class="va">aa</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">aa</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pcas</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, color<span class="op">=</span><span class="va">Cell</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">shadowtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shadowtext/man/geom_shadowtext.html">geom_shadowtext</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">label</span><span class="op">$</span><span class="va">meanX</span>,y<span class="op">=</span><span class="va">label</span><span class="op">$</span><span class="va">meanY</span>,label<span class="op">=</span><span class="va">label</span><span class="op">$</span><span class="va">Cell</span>, data<span class="op">=</span><span class="va">label</span>,</span>
<span>                            bg.colour<span class="op">=</span><span class="st">"white"</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">marker_1</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"1"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">marker_5</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"5"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">mk1_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_1</span><span class="op">)</span></span>
<span><span class="va">mk5_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_5</span><span class="op">)</span></span></code></pre></div>
<p>Obtain the color information from <code>ggplot2</code> and obtain pathway using <code>ggkegg</code>. Here, we selected <code>Osteoclast differentiation (hsa04380)</code>, nodes are colored by <code>ggfx</code> according to the colors in the reduced dimension plot, and markers in both cluster are colored by the specified color (<code>tomato</code>). This facilitates the linkage between pathway information, such as KEGG, and single-cell analysis data, enabling the creation of intuitive and comprehensible visual representations.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Make color map</span></span>
<span><span class="va">built</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span><span class="va">dd</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="va">built</span><span class="op">$</span><span class="va">colour</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">built</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">gr_cols</span> <span class="op">&lt;-</span> <span class="va">cols</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04380"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>marker_1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk1_enrich</span><span class="op">)</span>,</span>
<span>                                   marker_5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk5_enrich</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_1</span><span class="op">&amp;</span><span class="va">marker_5</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"tomato"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Marker 1 &amp; 5</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_1</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_5</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span> <span class="co">## Marker 1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_5</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_1</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"5"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span> <span class="co">## Marker 5</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04380"</span>, transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#cccccc"</span>,<span class="st">"#FFFFFF"</span>,<span class="st">"#BFBFFF"</span>,<span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gg</span><span class="op">+</span><span class="va">dd</span><span class="op">+</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/plot_sc-1.png" width="100%" style="display: block; margin: auto;"></div>
<div id="example-for-composing-multiple-pathways" class="section level3" number="5.5.1">
<h3>
<span class="header-section-number">5.5.1</span> Example for composing multiple pathways<a class="anchor" aria-label="anchor" href="#example-for-composing-multiple-pathways"><i class="fas fa-link"></i></a>
</h3>
<p>We can inspect marker genes in multiple pathways to better understand the role of marker genes.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/biomedical-knowledge-mining-book/">clusterProfiler</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subset_lab</span> <span class="op">&lt;-</span> <span class="va">label</span><span class="op">[</span><span class="va">label</span><span class="op">$</span><span class="va">Cell</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>,<span class="st">"6"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pcas</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, filter<span class="op">=</span><span class="va">group</span><span class="op">==</span><span class="st">"1"</span>, color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        colour<span class="op">=</span><span class="st">"tomato"</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, filter<span class="op">=</span><span class="va">group</span><span class="op">==</span><span class="st">"5"</span>, color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        colour<span class="op">=</span><span class="st">"tomato"</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, filter<span class="op">=</span><span class="va">group</span><span class="op">==</span><span class="st">"4"</span>, color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, filter<span class="op">=</span><span class="va">group</span><span class="op">==</span><span class="st">"6"</span>, color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">shadowtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shadowtext/man/geom_shadowtext.html">geom_shadowtext</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subset_lab</span><span class="op">$</span><span class="va">meanX</span>,</span>
<span>      y<span class="op">=</span><span class="va">subset_lab</span><span class="op">$</span><span class="va">meanY</span>, label<span class="op">=</span><span class="va">subset_lab</span><span class="op">$</span><span class="va">Cell</span>,</span>
<span>      data<span class="op">=</span><span class="va">subset_lab</span>,</span>
<span>      bg.colour<span class="op">=</span><span class="st">"white"</span>, colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">marker_1</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"1"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">marker_5</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"5"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">marker_6</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"6"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">marker_4</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"4"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span><span class="op">$</span><span class="va">ENTREZID</span></span>
<span><span class="va">mk1_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_1</span><span class="op">)</span></span>
<span><span class="va">mk5_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_5</span><span class="op">)</span></span>
<span><span class="va">mk6_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_6</span><span class="op">)</span></span>
<span><span class="va">mk4_enrich</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichKEGG.html">enrichKEGG</a></span><span class="op">(</span><span class="va">marker_4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04612"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>marker_4<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk4_enrich</span><span class="op">)</span>,</span>
<span>                                    marker_6<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk6_enrich</span><span class="op">)</span>,</span>
<span>                                    gene_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"hsa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g1</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04612"</span>, transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFFFFF"</span>, <span class="st">"#BFBFFF"</span>, <span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_4</span><span class="op">&amp;</span><span class="va">marker_6</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"gold"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_4</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_6</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"4"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_6</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_4</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"6"</span><span class="op">]</span>, expand<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04612"</span>, transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#B3B3B3"</span>, <span class="st">"#FFFFFF"</span>, <span class="st">"#BFBFFF"</span>, <span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04380"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>marker_1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk1_enrich</span><span class="op">)</span>,</span>
<span>                                    marker_5<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/append_cp.html">append_cp</a></span><span class="op">(</span><span class="va">mk5_enrich</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g2</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_1</span><span class="op">&amp;</span><span class="va">marker_5</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>, <span class="co">## Marker 1 &amp; 5</span></span>
<span>    colour<span class="op">=</span><span class="st">"tomato"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_1</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_5</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>, <span class="co">## Marker 1</span></span>
<span>    colour<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_5</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_1</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>, <span class="co">## Marker 5</span></span>
<span>    colour<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"5"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04380"</span>,</span>
<span>                  transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#cccccc"</span>,<span class="st">"#FFFFFF"</span>,<span class="st">"#BFBFFF"</span>,<span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">left</span> <span class="op">&lt;-</span>  <span class="op">(</span><span class="va">gg2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Marker 1 and 5"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">gg1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Marker 4 and 6"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="va">left</span> <span class="op">+</span> <span class="va">dd</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>design<span class="op">=</span><span class="st">"</span></span>
<span><span class="st">            AAAAA###</span></span>
<span><span class="st">            AAAAACCC</span></span>
<span><span class="st">            BBBBBCCC</span></span>
<span><span class="st">            BBBBB###</span></span>
<span><span class="st">            "</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/plot_sc2-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="barplot-for-numeric-values-on-raw-map" class="section level3" number="5.5.2">
<h3>
<span class="header-section-number">5.5.2</span> Barplot for numeric values on raw map<a class="anchor" aria-label="anchor" href="#barplot-for-numeric-values-on-raw-map"><i class="fas fa-link"></i></a>
</h3>
<p>For nodes in which they are enriched in multiple clusters, we can plot barplot for numeric values. The referenced codes are <a href="https://stackoverflow.com/questions/36063043/how-to-plot-barchart-onto-ggplot2-map">here</a> by inscaven.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Assign lfc to graph</span></span>
<span><span class="va">mark_4</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"4"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="va">mark_6</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="st">"6"</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="va">mark_4</span><span class="op">$</span><span class="va">lfc</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">[</span><span class="va">markers</span><span class="op">$</span><span class="va">cluster</span><span class="op">==</span><span class="st">"4"</span> <span class="op">&amp;</span> <span class="va">markers</span><span class="op">$</span><span class="va">gene</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mark_4</span><span class="op">$</span><span class="va">SYMBOL</span>,<span class="op">]</span><span class="op">$</span><span class="va">avg_log2FC</span></span>
<span><span class="va">mark_4</span><span class="op">$</span><span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"hsa:"</span>,<span class="va">mark_4</span><span class="op">$</span><span class="va">ENTREZID</span><span class="op">)</span></span>
<span><span class="va">mark_6</span><span class="op">$</span><span class="va">lfc</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">[</span><span class="va">markers</span><span class="op">$</span><span class="va">cluster</span><span class="op">==</span><span class="st">"6"</span> <span class="op">&amp;</span> <span class="va">markers</span><span class="op">$</span><span class="va">gene</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mark_4</span><span class="op">$</span><span class="va">SYMBOL</span>,<span class="op">]</span><span class="op">$</span><span class="va">avg_log2FC</span></span>
<span><span class="va">mark_6</span><span class="op">$</span><span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"hsa:"</span>,<span class="va">mark_6</span><span class="op">$</span><span class="va">ENTREZID</span><span class="op">)</span></span>
<span><span class="va">mk4lfc</span> <span class="op">&lt;-</span> <span class="va">mark_4</span><span class="op">$</span><span class="va">lfc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mk4lfc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mark_4</span><span class="op">$</span><span class="va">hsa</span></span>
<span><span class="va">mk6lfc</span> <span class="op">&lt;-</span> <span class="va">mark_6</span><span class="op">$</span><span class="va">lfc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mk6lfc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mark_6</span><span class="op">$</span><span class="va">hsa</span></span>
<span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mk4lfc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/node_numeric.html">node_numeric</a></span><span class="op">(</span><span class="va">mk4lfc</span><span class="op">)</span>,</span>
<span>             mk6lfc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/node_numeric.html">node_numeric</a></span><span class="op">(</span><span class="va">mk6lfc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Make data frame containing necessary data from node</span></span>
<span><span class="va">subset_df</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">marker_4</span> <span class="op">&amp;</span> <span class="va">marker_6</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">orig.id</span>, <span class="va">mk4lfc</span>, <span class="va">mk6lfc</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">xmin</span>, <span class="va">xmax</span>, <span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mk4lfc"</span>,<span class="st">"mk6lfc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Actually we dont need position list</span></span>
<span><span class="va">pos_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">annot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">subset_df</span><span class="op">$</span><span class="va">orig.id</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">subset_df</span><span class="op">[</span><span class="va">subset_df</span><span class="op">$</span><span class="va">orig.id</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span></span>
<span>    <span class="va">ymin</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">ymin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">ymax</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">xmin</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">xmin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">xmax</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">xmax</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">pos_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span>,</span>
<span>                                     <span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span></span>
<span>    <span class="va">barp</span> <span class="op">&lt;-</span> <span class="va">tmp</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"4"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                   <span class="va">gr_cols</span><span class="op">[</span><span class="st">"6"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>            legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>            panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>            line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="va">gbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">barp</span><span class="op">)</span></span>
<span>    <span class="va">panel_coords</span> <span class="op">&lt;-</span> <span class="va">gbar</span><span class="op">$</span><span class="va">layout</span><span class="op">[</span><span class="va">gbar</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"panel"</span>, <span class="op">]</span></span>
<span>    <span class="va">gbar_mod</span> <span class="op">&lt;-</span> <span class="va">gbar</span><span class="op">[</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">t</span><span class="op">:</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">b</span>, <span class="va">panel_coords</span><span class="op">$</span><span class="va">l</span><span class="op">:</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">r</span><span class="op">]</span></span>
<span>    <span class="va">annot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="va">gbar_mod</span>,</span>
<span>                                                      xmin<span class="op">=</span><span class="va">xmin</span>, xmax<span class="op">=</span><span class="va">xmax</span>,</span>
<span>                                                      ymin<span class="op">=</span><span class="va">ymin</span>, ymax<span class="op">=</span><span class="va">ymax</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Make ggraph, annotate barplot, and overlay raw map.</span></span>
<span><span class="va">graph_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g1</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_4</span><span class="op">&amp;</span><span class="va">marker_6</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="st">"gold"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_4</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_6</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"4"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>filter<span class="op">=</span><span class="va">marker_6</span><span class="op">&amp;</span><span class="op">!</span><span class="va">marker_4</span><span class="op">)</span>,</span>
<span>                   fill<span class="op">=</span><span class="va">gr_cols</span><span class="op">[</span><span class="st">"6"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">final_bar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">annot_list</span>, <span class="va">graph_tmp</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04612"</span>,</span>
<span>                transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFFFFF"</span>,</span>
<span>                                       <span class="st">"#BFBFFF"</span>,</span>
<span>                                       <span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">final_bar</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/barp_prepare-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="barplot-across-all-the-clusters" class="section level3" number="5.5.3">
<h3>
<span class="header-section-number">5.5.3</span> Barplot across all the clusters<a class="anchor" aria-label="anchor" href="#barplot-across-all-the-clusters"><i class="fas fa-link"></i></a>
</h3>
<p>By iterating the above codes, we can plot all the clusters’ quantitative data on plot. Although it is preferred to use ggplot2 mapping to produce the legend, here we obtain the legend from reduced dimension plot.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"hsa04612"</span><span class="op">)</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">cluster_num</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cluster_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">cluster_num</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">mark</span> <span class="op">&lt;-</span> <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/bitr.html">bitr</a></span><span class="op">(</span><span class="op">(</span><span class="va">markers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">==</span><span class="va">cluster_num</span> <span class="op">&amp;</span> <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">1e-50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">gene</span>,fromType<span class="op">=</span><span class="st">"SYMBOL"</span>,toType<span class="op">=</span><span class="st">"ENTREZID"</span>,OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span>    <span class="va">mark</span><span class="op">$</span><span class="va">lfc</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">[</span><span class="va">markers</span><span class="op">$</span><span class="va">cluster</span><span class="op">==</span><span class="va">cluster_num</span> <span class="op">&amp;</span> <span class="va">markers</span><span class="op">$</span><span class="va">gene</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mark</span><span class="op">$</span><span class="va">SYMBOL</span>,<span class="op">]</span><span class="op">$</span><span class="va">avg_log2FC</span></span>
<span>    <span class="va">mark</span><span class="op">$</span><span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"hsa:"</span>,<span class="va">mark</span><span class="op">$</span><span class="va">ENTREZID</span><span class="op">)</span></span>
<span>    <span class="va">coln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"marker"</span>,<span class="va">cluster_num</span>,<span class="st">"lfc"</span><span class="op">)</span></span>
<span>    <span class="va">g1</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">coln</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/node_numeric.html">node_numeric</a></span><span class="op">(</span><span class="va">mark</span><span class="op">$</span><span class="va">lfc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">mark</span><span class="op">$</span><span class="va">hsa</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Make <code><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob()</a></code>.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">subset_df</span> <span class="op">&lt;-</span> <span class="va">g1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">orig.id</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"marker"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"lfc"</span><span class="op">)</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">xmin</span>, <span class="va">xmax</span>, <span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"marker"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"lfc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pos_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">annot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">all_gr_cols</span> <span class="op">&lt;-</span> <span class="va">gr_cols</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">all_gr_cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"marker"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">all_gr_cols</span><span class="op">)</span>,<span class="st">"lfc"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">subset_df</span><span class="op">$</span><span class="va">orig.id</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">subset_df</span><span class="op">[</span><span class="va">subset_df</span><span class="op">$</span><span class="va">orig.id</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span></span>
<span>    <span class="va">ymin</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">ymin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">ymax</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">xmin</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">xmin</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">xmax</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">xmax</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">pos_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span>,</span>
<span>                                     <span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">tmp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">barp</span> <span class="op">&lt;-</span> <span class="va">tmp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">all_gr_cols</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="co">## We add horizontal line to show the direction of bar</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>                legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"transparent"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="va">gbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">barp</span><span class="op">)</span></span>
<span>        <span class="va">panel_coords</span> <span class="op">&lt;-</span> <span class="va">gbar</span><span class="op">$</span><span class="va">layout</span><span class="op">[</span><span class="va">gbar</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"panel"</span>, <span class="op">]</span></span>
<span>        <span class="va">gbar_mod</span> <span class="op">&lt;-</span> <span class="va">gbar</span><span class="op">[</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">t</span><span class="op">:</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">b</span>, <span class="va">panel_coords</span><span class="op">$</span><span class="va">l</span><span class="op">:</span><span class="va">panel_coords</span><span class="op">$</span><span class="va">r</span><span class="op">]</span></span>
<span>        <span class="va">annot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="va">gbar_mod</span>,</span>
<span>                                                           xmin<span class="op">=</span><span class="va">xmin</span>, xmax<span class="op">=</span><span class="va">xmax</span>,</span>
<span>                                                           ymin<span class="op">=</span><span class="va">ymin</span>, ymax<span class="op">=</span><span class="va">ymax</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Obtain legend and modify.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Take scplot legend, make it rectangle</span></span>
<span><span class="co">## Make pseudo plot</span></span>
<span><span class="va">dd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pcas</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC_1</span>, y<span class="op">=</span><span class="va">PC_2</span>, color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape<span class="op">=</span><span class="fl">15</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">grobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_gtable.html">ggplot_gtable</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span><span class="va">dd2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">grobs</span><span class="op">$</span><span class="va">grobs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="st">"guide-box"</span><span class="op">)</span></span>
<span><span class="va">legendGrob</span> <span class="op">&lt;-</span> <span class="va">grobs</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">num</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Show it</span></span>
<span><span class="fu">ggplotify</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggplotify/man/as.ggplot.html">as.ggplot</a></span><span class="op">(</span><span class="va">legendGrob</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/legend1-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Make dummy legend by `fill`</span></span>
<span><span class="va">graph_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g1</span>, layout<span class="op">=</span><span class="st">"manual"</span>, x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/geom_node_rect.html">geom_node_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="st">"transparent"</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Overlaid the raw map</span></span>
<span><span class="va">overlaid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">annot_list</span>, <span class="va">graph_tmp</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/overlay_raw_map.html">overlay_raw_map</a></span><span class="op">(</span><span class="st">"hsa04612"</span>,</span>
<span>                    transparent_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFFFFF"</span>,</span>
<span>                                           <span class="st">"#BFBFFF"</span>,</span>
<span>                                           <span class="st">"#BFFFBF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Replace the guides</span></span>
<span><span class="va">overlaidGtable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_gtable.html">ggplot_gtable</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span><span class="va">overlaid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">num2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">overlaidGtable</span><span class="op">$</span><span class="va">grobs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="st">"guide-box"</span><span class="op">)</span></span>
<span><span class="va">overlaidGtable</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">num2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">legendGrob</span></span>
<span></span>
<span><span class="fu">ggplotify</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggplotify/man/as.ggplot.html">as.ggplot</a></span><span class="op">(</span><span class="va">overlaidGtable</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/legend2-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="customizing-global-map-visualization" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Customizing global map visualization<a class="anchor" aria-label="anchor" href="#customizing-global-map-visualization"><i class="fas fa-link"></i></a>
</h2>
<p>One advantage of using <code>ggkegg</code> is visualizing global maps effectively using the power of <code>ggplot2</code> and <code>ggraph</code>. Here, I present an example of visualizing log2 fold change values obtained from some microbiome experiments in global map. First, we load necessary data, which can be obtained from your dataset investigating KO, obtained from the pipeline such as <code>HUMAnN3</code>.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"../lfcs.rda"</span><span class="op">)</span> <span class="co">## Storing named vector of KOs storing LFCs and significant KOs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"../func_cat.rda"</span><span class="op">)</span> <span class="co">## Functional categories for hex values in ko01100</span></span>
<span></span>
<span><span class="va">lfcs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  ko:K00013  ko:K00018  ko:K00031  ko:K00042  ko:K00065 </span></span>
<span><span class="co">#&gt; -0.2955686 -0.4803597 -0.3052872  0.9327130  1.0954976 </span></span>
<span><span class="co">#&gt;  ko:K00087 </span></span>
<span><span class="co">#&gt;  0.8713860</span></span>
<span><span class="va">signame</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ko:K00013" "ko:K00018" "ko:K00031" "ko:K00042"</span></span>
<span><span class="co">#&gt; [5] "ko:K00065" "ko:K00087"</span></span>
<span><span class="va">func_cat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   hex     class                                        top  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                                        &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 #B3B3E6 Metabolism; Carbohydrate metabolism          Amin…</span></span>
<span><span class="co">#&gt; 2 #F06292 Metabolism; Biosynthesis of other secondary… Bios…</span></span>
<span><span class="co">#&gt; 3 #FFB3CC Metabolism; Metabolism of cofactors and vit… Bios…</span></span>
<span><span class="co">#&gt; 4 #FF8080 Metabolism; Nucleotide metabolism            Puri…</span></span>
<span><span class="co">#&gt; 5 #6C63F6 Metabolism; Carbohydrate metabolism          Glyc…</span></span>
<span><span class="co">#&gt; 6 #FFCC66 Metabolism; Amino acid metabolism            Bios…</span></span>
<span></span>
<span><span class="co">## Named vector for Assigning functional category </span></span>
<span><span class="va">hex</span> <span class="op">&lt;-</span> <span class="va">func_cat</span><span class="op">$</span><span class="va">hex</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">func_cat</span><span class="op">$</span><span class="va">hex</span><span class="op">)</span></span>
<span><span class="va">class</span> <span class="op">&lt;-</span> <span class="va">func_cat</span><span class="op">$</span><span class="va">class</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">func_cat</span><span class="op">$</span><span class="va">hex</span><span class="op">)</span></span>
<span><span class="va">hex</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   #B3B3E6   #F06292   #FFB3CC   #FF8080   #6C63F6   #FFCC66 </span></span>
<span><span class="co">#&gt; "#B3B3E6" "#F06292" "#FFB3CC" "#FF8080" "#6C63F6" "#FFCC66"</span></span>
<span><span class="va">class</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                   #B3B3E6 </span></span>
<span><span class="co">#&gt;                     "Metabolism; Carbohydrate metabolism" </span></span>
<span><span class="co">#&gt;                                                   #F06292 </span></span>
<span><span class="co">#&gt; "Metabolism; Biosynthesis of other secondary metabolites" </span></span>
<span><span class="co">#&gt;                                                   #FFB3CC </span></span>
<span><span class="co">#&gt;        "Metabolism; Metabolism of cofactors and vitamins" </span></span>
<span><span class="co">#&gt;                                                   #FF8080 </span></span>
<span><span class="co">#&gt;                       "Metabolism; Nucleotide metabolism" </span></span>
<span><span class="co">#&gt;                                                   #6C63F6 </span></span>
<span><span class="co">#&gt;                     "Metabolism; Carbohydrate metabolism" </span></span>
<span><span class="co">#&gt;                                                   #FFCC66 </span></span>
<span><span class="co">#&gt;                       "Metabolism; Amino acid metabolism"</span></span></code></pre></div>
<div id="preprocessing" class="section level3" number="5.6.1">
<h3>
<span class="header-section-number">5.6.1</span> Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"><i class="fas fa-link"></i></a>
</h3>
<p>We obtained <code>tbl_graph</code> of ko01100, and process the graph. First, we append edges corresponding to inter-compound relationships. Although most of the reactions are reversible and by default adds two edges in <code>process_reaction</code>, we specify <code>single_edge=TRUE</code> here for visualization. Also, converting compound ID and KO ID and append attributes to graph.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">ggkegg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/pathway.html">pathway</a></span><span class="op">(</span><span class="st">"ko01100"</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/process_reaction.html">process_reaction</a></span><span class="op">(</span>single_edge<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>compn<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"compound"</span>,</span>
<span>                                          first_arg_comma <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>kon<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/convert_id.html">convert_id</a></span><span class="op">(</span><span class="st">"ko"</span>,edge<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next we append values such as KOs and degrees to graph. In addition, here we append additional attribute, like which species have the enzymes, to the graph. This type of information can be obtained from stratified output of <code>HUMAnN3</code>.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>kolfc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggkegg/man/edge_numeric.html">edge_numeric</a></span><span class="op">(</span><span class="va">lfcs</span><span class="op">)</span>, <span class="co">## Pre-computed LFCs</span></span>
<span>         siglgl<span class="op">=</span><span class="va">.data</span><span class="op">$</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">signame</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">## Whether the KO is significant</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span><span class="op">==</span><span class="st">"compound"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">## Subset to compound nodes and </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Degree<span class="op">=</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_degree</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">## Calculate degree</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Degree</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">## Filter based on degree</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Species<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">kon</span><span class="op">==</span><span class="st">"lyxK"</span>, <span class="st">"Escherichia coli"</span>, <span class="st">"Others"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We next check overall classes of these KOs based on ko01100, and the class with the highest number of KOs was Carbohydrate metabolism.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class_table</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">g</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>siglgl<span class="op">=</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">signame</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">siglgl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">fgcolor</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span>decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">class_table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">class</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">class_table</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">class_table</span></span>
<span><span class="co">#&gt;                     Metabolism; Carbohydrate metabolism </span></span>
<span><span class="co">#&gt;                                                      20 </span></span>
<span><span class="co">#&gt;          Metabolism; Glycan biosynthesis and metabolism </span></span>
<span><span class="co">#&gt;                                                      16 </span></span>
<span><span class="co">#&gt;        Metabolism; Metabolism of cofactors and vitamins </span></span>
<span><span class="co">#&gt;                                                      11 </span></span>
<span><span class="co">#&gt;                       Metabolism; Amino acid metabolism </span></span>
<span><span class="co">#&gt;                                                       8 </span></span>
<span><span class="co">#&gt;                       Metabolism; Nucleotide metabolism </span></span>
<span><span class="co">#&gt;                                                       7 </span></span>
<span><span class="co">#&gt;    Metabolism; Metabolism of terpenoids and polyketides </span></span>
<span><span class="co">#&gt;                                                       3 </span></span>
<span><span class="co">#&gt;                           Metabolism; Energy metabolism </span></span>
<span><span class="co">#&gt;                                                       3 </span></span>
<span><span class="co">#&gt;   Metabolism; Xenobiotics biodegradation and metabolism </span></span>
<span><span class="co">#&gt;                                                       3 </span></span>
<span><span class="co">#&gt;                     Metabolism; Carbohydrate metabolism </span></span>
<span><span class="co">#&gt;                                                       2 </span></span>
<span><span class="co">#&gt;                            Metabolism; Lipid metabolism </span></span>
<span><span class="co">#&gt;                                                       1 </span></span>
<span><span class="co">#&gt; Metabolism; Biosynthesis of other secondary metabolites </span></span>
<span><span class="co">#&gt;                                                       1 </span></span>
<span><span class="co">#&gt;             Metabolism; Metabolism of other amino acids </span></span>
<span><span class="co">#&gt;                                                       1</span></span></code></pre></div>
</div>
<div id="plotting" class="section level3" number="5.6.2">
<h3>
<span class="header-section-number">5.6.2</span> Plotting<a class="anchor" aria-label="anchor" href="#plotting"><i class="fas fa-link"></i></a>
</h3>
<p>We first visualize overall global map using the default values in <code>ko01100</code> and calculated degree.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g2</span>, layout<span class="op">=</span><span class="st">"fr"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">fgcolor</span><span class="op">)</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">fgcolor</span><span class="op">)</span>, size<span class="op">=</span><span class="va">Degree</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span>, shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/glplot1-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>We can apply various geoms to components in KEGG PATHWAY for the effective visualization. In this example, we highlighted significant edges (KOs) colored by their LFCs by <code>ggfx</code>, point size corresponding to degree in the network, and we showed edge label of significant KO names. KO names were colored by <code>Species</code> attributes. This time we set this to <code>Escherichia coli</code> and <code>Others</code>.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">g2</span>, layout<span class="op">=</span><span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_diagonal</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"grey50"</span>, width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span> <span class="co">## Base edge</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_diagonal</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">kolfc</span>,filter<span class="op">=</span><span class="va">siglgl</span><span class="op">)</span>,</span>
<span>                       angle_calc <span class="op">=</span> <span class="st">"along"</span>,</span>
<span>                       label_size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">3</span></span>
<span>  <span class="op">)</span><span class="op">+</span> <span class="co">## Highlight significant edges</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">0</span>, mid <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                                    low<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>                                    high<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>                                    name<span class="op">=</span><span class="st">"LFC"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Set gradient color</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">bgcolor</span>,size<span class="op">=</span><span class="va">Degree</span><span class="op">)</span>,</span>
<span>                  shape<span class="op">=</span><span class="fl">21</span>,</span>
<span>                  color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Node size set to degree</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_label_diagonal</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    label<span class="op">=</span><span class="va">kon</span>,</span>
<span>    label_colour<span class="op">=</span><span class="va">Species</span>,</span>
<span>    filter<span class="op">=</span><span class="va">siglgl</span></span>
<span>  <span class="op">)</span>,</span>
<span>  angle_calc <span class="op">=</span> <span class="st">"along"</span>,</span>
<span>  label_size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span><span class="op">+</span> <span class="co">## Showing edge label, label color is Species attribute</span></span>
<span>  <span class="fu">scale_label_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tomato"</span>,<span class="st">"black"</span><span class="op">)</span>,</span>
<span>                            name<span class="op">=</span><span class="st">"Species"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Scale color for edge label</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">hex</span>,labels<span class="op">=</span><span class="va">class</span>,name<span class="op">=</span><span class="st">"Class"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Show legend based on HEX</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">## Change legend point size</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/glplot2-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>If we want to investigate the specific class, subset by HEX value in graph.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Subset and do the same thing</span></span>
<span><span class="va">g2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_subgraph</span>, <span class="va">siglgl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tmp<span class="op">=</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_degree</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>subname<span class="op">=</span><span class="va">compn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bgcolor</span><span class="op">==</span><span class="st">"#B3B3E6"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Degree<span class="op">=</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_degree</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"all"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">## Calculate degree</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Degree</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span>layout<span class="op">=</span><span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_diagonal</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"grey50"</span>, width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">+</span> <span class="co">## Base edge</span></span>
<span>  <span class="fu">ggfx</span><span class="fu">::</span><span class="fu"><a href="https://ggfx.data-imaginist.com/reference/with_outer_glow.html">with_outer_glow</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_diagonal</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">kolfc</span>,filter<span class="op">=</span><span class="va">siglgl</span><span class="op">)</span>,</span>
<span>                       angle_calc <span class="op">=</span> <span class="st">"along"</span>,</span>
<span>                       label_size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span>,</span>
<span>    colour<span class="op">=</span><span class="st">"gold"</span>, expand<span class="op">=</span><span class="fl">3</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html">scale_edge_color_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">0</span>, mid <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                             low<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>,</span>
<span>                             high<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,</span>
<span>                             name<span class="op">=</span><span class="st">"LFC"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">bgcolor</span>,size<span class="op">=</span><span class="va">Degree</span><span class="op">)</span>,</span>
<span>                  shape<span class="op">=</span><span class="fl">21</span>,</span>
<span>                  color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_diagonal.html">geom_edge_label_diagonal</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    label<span class="op">=</span><span class="va">kon</span>,</span>
<span>    label_colour<span class="op">=</span><span class="va">Species</span>,</span>
<span>    filter<span class="op">=</span><span class="va">siglgl</span></span>
<span>  <span class="op">)</span>,</span>
<span>  angle_calc <span class="op">=</span> <span class="st">"along"</span>,</span>
<span>  label_size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span><span class="op">+</span> <span class="co">## Showing edge label</span></span>
<span>  <span class="fu">scale_label_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tomato"</span>,<span class="st">"black"</span><span class="op">)</span>,</span>
<span>                            name<span class="op">=</span><span class="st">"Species"</span><span class="op">)</span><span class="op">+</span> <span class="co">## Scale color for edge label</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">subname</span>,<span class="fl">10</span>,whitespace_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    repel<span class="op">=</span><span class="cn">TRUE</span>, bg.colour<span class="op">=</span><span class="st">"white"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="va">hex</span>,labels<span class="op">=</span><span class="va">class</span>,name<span class="op">=</span><span class="st">"Class"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-usecases_files/figure-html/glplot3-1.png" width="100%" style="display: block; margin: auto;"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="network.html"><span class="header-section-number">4</span> Network</a></div>
<div class="next"><a href="notes.html"><span class="header-section-number">6</span> Notes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#usecases"><span class="header-section-number">5</span> Usecases</a></li>
<li>
<a class="nav-link" href="#visualizing-numerical-attributes-from-deseq2"><span class="header-section-number">5.1</span> Visualizing numerical attributes from DESeq2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-ggfx-to-further-customize-the-visualization"><span class="header-section-number">5.1.1</span> using ggfx to further customize the visualization</a></li>
<li><a class="nav-link" href="#using-multiple-geoms-to-add-information"><span class="header-section-number">5.1.2</span> using multiple geoms to add information</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#integrating-numeric-values-onto-tbl_graph"><span class="header-section-number">5.2</span> Integrating numeric values onto tbl_graph</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#integrating-numeric-vector-to-tbl_graph"><span class="header-section-number">5.2.1</span> Integrating numeric vector to tbl_graph</a></li>
<li><a class="nav-link" href="#integrating-matrix-to-tbl_graph"><span class="header-section-number">5.2.2</span> Integrating matrix to tbl_graph</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#visualizing-multiple-enrichment-results"><span class="header-section-number">5.3</span> Visualizing multiple enrichment results</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#multiple-enrichment-analysis-results-across-multiple-pathways"><span class="header-section-number">5.3.1</span> Multiple enrichment analysis results across multiple pathways</a></li></ul>
</li>
<li>
<a class="nav-link" href="#projecting-the-gene-regulatory-networks-on-kegg-map"><span class="header-section-number">5.4</span> Projecting the gene regulatory networks on KEGG map</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#projection-on-to-the-raw-kegg-map"><span class="header-section-number">5.4.1</span> Projection on to the raw KEGG map</a></li></ul>
</li>
<li>
<a class="nav-link" href="#analyzing-cluster-marker-genes-in-single-cell-transcriptomics"><span class="header-section-number">5.5</span> Analyzing cluster marker genes in single-cell transcriptomics</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#example-for-composing-multiple-pathways"><span class="header-section-number">5.5.1</span> Example for composing multiple pathways</a></li>
<li><a class="nav-link" href="#barplot-for-numeric-values-on-raw-map"><span class="header-section-number">5.5.2</span> Barplot for numeric values on raw map</a></li>
<li><a class="nav-link" href="#barplot-across-all-the-clusters"><span class="header-section-number">5.5.3</span> Barplot across all the clusters</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#customizing-global-map-visualization"><span class="header-section-number">5.6</span> Customizing global map visualization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#preprocessing"><span class="header-section-number">5.6.1</span> Preprocessing</a></li>
<li><a class="nav-link" href="#plotting"><span class="header-section-number">5.6.2</span> Plotting</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ggkegg</strong>" was written by Noriaki Sato. It was last built on 2023-12-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
